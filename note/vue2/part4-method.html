<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue.js æºç  â€”â€” å®ä¾‹æ–¹æ³• | Vue-Demo-Collection</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="A documentation of the excellent components encountered in VUE development">
    
    <link rel="preload" href="/vue-demo-collection/assets/css/0.styles.41da42df.css" as="style"><link rel="preload" href="/vue-demo-collection/assets/js/app.f5b96e8e.js" as="script"><link rel="preload" href="/vue-demo-collection/assets/js/7.ac4e68a0.js" as="script"><link rel="preload" href="/vue-demo-collection/assets/js/80.c5fc458b.js" as="script"><link rel="prefetch" href="/vue-demo-collection/assets/js/1.2e2b4322.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/10.6fe83197.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/11.607bf541.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/12.240a3ba2.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/13.5f3ec41a.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/14.c64dd16f.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/15.04283614.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/16.833af79b.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/17.4daaa688.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/18.088bf1a8.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/19.b9758386.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/2.2d5faf37.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/20.3b799ac1.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/21.ac51364b.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/22.c44a5a8f.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/23.75b8ffb8.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/24.7553e43b.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/25.cd523bbf.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/26.b58a03fa.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/27.e4741fa3.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/28.9dbdb2e3.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/29.1c444fa8.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/3.da5e3f9c.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/30.d656d726.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/31.ae9630e4.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/32.8a6fd8e6.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/33.877edd59.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/34.a357b142.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/35.2d0c38e2.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/36.18bacde9.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/37.186a837c.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/38.f2fc3138.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/39.dabd2123.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/4.20b3f9b2.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/40.c511b4c2.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/41.4cad3d23.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/42.9136ea93.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/43.9678c4e1.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/44.09158630.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/45.76503459.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/46.756f2a47.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/47.fa58ae45.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/48.9b745272.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/49.d1bf558f.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/5.90b8032d.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/50.ac5f466d.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/51.38a211b6.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/52.960e4db6.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/53.73267aeb.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/54.434a97c0.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/55.57400b27.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/56.e828cd7c.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/57.794280cf.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/58.e0e41a13.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/59.374c4057.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/60.a292140c.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/61.d6e64963.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/62.951cb72d.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/63.ab7ebef5.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/64.ea299191.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/65.35bb57b8.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/66.96b69f7d.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/67.9f43214c.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/68.acad029f.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/69.4dd36d2f.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/70.8514f7a6.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/71.a1e6d21e.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/72.85e4760a.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/73.82d83fb8.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/74.94a16f58.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/75.c1fdfff9.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/76.6dbd6ea2.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/77.431a65f0.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/78.ffce0429.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/79.a8b30c75.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/8.7b37b1dc.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/81.294e85c3.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/9.7075ed80.js">
    <link rel="stylesheet" href="/vue-demo-collection/assets/css/0.styles.41da42df.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue-demo-collection/" class="home-link router-link-active"><img src="/vue-demo-collection/logo.png" alt="Vue-Demo-Collection" class="logo"> <span class="site-name can-hide">Vue-Demo-Collection</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-demo-collection/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/vue-demo-collection/base/" class="nav-link">
  ç»„ä»¶
</a></div><div class="nav-item"><a href="/vue-demo-collection/note/" class="nav-link router-link-active">
  ç¬”è®°
</a></div><div class="nav-item"><a href="/vue-demo-collection/essays/" class="nav-link">
  éšç¬”
</a></div><div class="nav-item"><a href="https://github.com/Gesj-yean/vue-demo-collection" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-demo-collection/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/vue-demo-collection/base/" class="nav-link">
  ç»„ä»¶
</a></div><div class="nav-item"><a href="/vue-demo-collection/note/" class="nav-link router-link-active">
  ç¬”è®°
</a></div><div class="nav-item"><a href="/vue-demo-collection/essays/" class="nav-link">
  éšç¬”
</a></div><div class="nav-item"><a href="https://github.com/Gesj-yean/vue-demo-collection" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/vue-demo-collection/note/" class="sidebar-heading clickable router-link-active open"><span>Vue2 æºç å­¦ä¹ </span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-demo-collection/note/vue2/part1-start.html" class="sidebar-link">part1 - åŸºæœ¬çŸ¥è¯†ï¼šFlow</a></li><li><a href="/vue-demo-collection/note/vue2/part2-build.html" class="sidebar-link">part2 - Vue + Rollup æ„å»ºè¿‡ç¨‹</a></li><li><a href="/vue-demo-collection/note/vue2/part3-entry.html" class="sidebar-link">part3 - Vue.js å…¥å£æ–‡ä»¶åˆ†æ</a></li><li><a href="/vue-demo-collection/note/vue2/part4-method.html" aria-current="page" class="active sidebar-link">part4 - å®ä¾‹æ–¹æ³•</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/vue-demo-collection/note/js/" class="sidebar-heading clickable"><span>Javascript é«˜çº§ç¨‹åºè®¾è®¡</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-demo-collection/note/js/garbage-collection.html" class="sidebar-link">åƒåœ¾å›æ”¶</a></li><li><a href="/vue-demo-collection/note/js/map.html" class="sidebar-link">Map</a></li><li><a href="/vue-demo-collection/note/js/set.html" class="sidebar-link">Set</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-js-æºç -å®ä¾‹æ–¹æ³•"><a href="#vue-js-æºç -å®ä¾‹æ–¹æ³•" class="header-anchor">#</a> Vue.js æºç  â€”â€” å®ä¾‹æ–¹æ³•</h1> <p>åœ¨ä¸Šä¸€èŠ‚çš„ <a href="https://juejin.cn/post/7058551430566641700" target="_blank" rel="noopener noreferrer"><strong>Vue å…¥å£æ–‡ä»¶</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> é‡Œï¼ŒVue çš„å°è£…åˆ†äº†ä¸‰ä¸ªæ­¥éª¤ï¼š</p> <ol><li>ç”¨ mixin æ–‡ä»¶ä¸º Vue æ·»åŠ  <a href="https://cn.vuejs.org/v2/api/#%E5%AE%9E%E4%BE%8B-property" target="_blank" rel="noopener noreferrer"><strong>Vue 2.x API æ–‡æ¡£</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¸­å®šä¹‰çš„å®ä¾‹æ–¹æ³•ã€‚</li> <li>ä¸º Vue æ·»åŠ å…¨å±€ APIã€‚</li> <li>patch å’Œ $mount æ–¹æ³•ã€‚</li></ol> <p>ä»Šå¤©æˆ‘ä»¬æ¥åˆ†æç¬¬ä¸€æ­¥ï¼š Vue æ˜¯å¦‚ä½•å®šä¹‰è¿™äº›å®ä¾‹æ–¹æ³•ã€‚</p> <p>å®ä¾‹æ–¹æ³•ä¸­æœ‰å››ä¸ªéƒ¨åˆ†ï¼š<strong>å®ä¾‹ propertyã€å®ä¾‹æ–¹æ³•/æ•°æ®ã€å®ä¾‹æ–¹æ³•/ç”Ÿå‘½å‘¨æœŸã€å®ä¾‹æ–¹æ³•/äº‹ä»¶</strong>ã€‚å…³äºè¿™äº›å®ä¾‹æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ <code>src/core/instance/index.js</code> æ–‡ä»¶ä¸­å¼•å…¥å¯¹åº”çš„ mixin å‡½æ•°åœ¨ Vue æ–¹æ³•çš„åŸå‹é“¾ä¸Šæ·»åŠ å®ä¾‹æ–¹æ³•ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> initMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./init'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> stateMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./state'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> renderMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./render'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> eventsMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./events'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> lifecycleMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./lifecycle'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> warn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span>

<span class="token keyword">function</span> <span class="token function">Vue</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Vue</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Vue is a constructor and should be called with the `new` keyword'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">stateMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">eventsMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">lifecycleMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">renderMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Vue

</code></pre></div><p>åœ¨è¿™äº› mixin ä¸­åˆ†åˆ«å®šä¹‰äº†å…·ä½“çš„åŸå‹æ–¹æ³•ğŸ‘‡ã€‚</p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/89b50eaf03924cafb24e296167709cf2~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <h2 id="initmixin"><a href="#initmixin" class="header-anchor">#</a> initMixin</h2> <p>åœ¨ initMixin æ–¹æ³•ä¸­ç»™ Vue æ·»åŠ äº†å®ä¾‹æ–¹æ³• <code>_init</code>ï¼Œåœ¨ <code>_init</code> æ–¹æ³•ä¸­è§¦å‘äº†ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ï¼š <code>beforeCreate</code> å’Œ <code>created</code>ã€‚</p> <p>åœ¨ <code>beforeCreate</code> ä¹‹å‰ï¼Œåˆå§‹åŒ–äº† $parentã€ $rootã€ $childrenã€ $refs å’Œ $onã€ $offã€ $onceã€‚</p> <p>åœ¨ <code>beforeCreate</code> ç»“æŸåï¼Œæ‰åˆå§‹åŒ–äº† propsã€methodsã€dataã€computedã€watch æ–¹æ³•ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* @flow */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Vue</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¸€äº›ä¼˜åŒ–å†…éƒ¨ç»„ä»¶å®ä¾‹åŒ–å·¥ä½œï¼š merge options </span>
    <span class="token comment">// åˆå§‹åŒ– Proxy è®¾ç½®</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">initProxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_renderProxy <span class="token operator">=</span> vm
    <span class="token punctuation">}</span>
    
    <span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// åˆå§‹åŒ– $parentã€$rootã€$childrenã€$refs</span>
    <span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// æ·»åŠ  $on $off $once ç­‰ listener</span>
    <span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// createElementï¼Œå“åº”å¼ $attrs å’Œ $listeners</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeCreate'</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»º beforeCreate ç”Ÿå‘½å‘¨æœŸé’©å­</span>
    <span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve injections before data/props</span>
    <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// åˆå§‹åŒ– propsã€methodsã€dataã€computedã€watch</span>
    <span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve provide after data/props</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">)</span> <span class="token comment">//// åˆ›å»º created ç”Ÿå‘½å‘¨æœŸé’©å­</span>

    <span class="token comment">// æŒ‚è½½</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// å…¶ä»–çš„ä¸€äº›å…³äº merge options æ–¹æ³•</span>
</code></pre></div><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™äº›ç»“è®ºï¼š</p> <ol><li>å› æ­¤æˆ‘ä»¬æƒ³è¦è°ƒç”¨ data é‡Œçš„å±æ€§ï¼Œæœ€æ—©çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ <code>created</code>ã€‚</li></ol> <h2 id="statemixin"><a href="#statemixin" class="header-anchor">#</a> stateMixin</h2> <p>åœ¨ stateMixin ä¸­ï¼Œåœ¨ Vue çš„åŸå‹ä¸Šå®šä¹‰äº†ä¸¤ä¸ªå®ä¾‹ propertiesï¼š <code>$data</code> <code>$props</code>ï¼Œä»¥åŠä¸‰ä¸ªå®ä¾‹æ–¹æ³•/æ•°æ®ï¼š <code>$set</code> <code>$delete</code> <code>$watch</code>ã€‚</p> <p>stateMixin çš„ç»“æ„å’Œé¡ºåºå¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">stateMixin</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Vue</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœç•¥ dataDef å’Œ propsDef å…·ä½“å®šä¹‰è¿‡ç¨‹</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$data'</span><span class="token punctuation">,</span> dataDef<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$props'</span><span class="token punctuation">,</span> propsDef<span class="token punctuation">)</span>
  
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$set <span class="token operator">=</span> <span class="token keyword">set</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$<span class="token keyword">delete</span> <span class="token operator">=</span> del
  
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$watch <span class="token comment">// çœç•¥ $watch å…·ä½“æ–¹æ³•</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="data-ã€-props"><a href="#data-ã€-props" class="header-anchor">#</a> $data ã€ $props</h3> <p>å…ˆæ¥çœ‹ä¸€ä¸‹ <code>$data</code> ã€ <code>$props</code> çš„å®šä¹‰çš„æºç  ğŸ‘‡ï¼Œå…¶å®éå¸¸ç®€å•ï¼Œå®ƒç›´æ¥è¿”å›äº† _data å¯¹è±¡å’Œ _props å¯¹è±¡ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> dataDef <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  dataDef<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_data <span class="token punctuation">}</span>
  <span class="token keyword">const</span> propsDef <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  propsDef<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_props <span class="token punctuation">}</span>
  
  <span class="token comment">// éç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œå¯¹ $data å’Œ $props è¿›è¡Œä¿®æ”¹èµ‹å€¼æ“ä½œä¼šæŠ¥é”™ï¼š</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dataDef<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// æŠ›å‡ºé”™è¯¯ï¼šAvoid replacing instance root $data. Use nested data properties instead. </span>
    <span class="token punctuation">}</span>
    propsDef<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// æŠ›å‡ºé”™è¯¯ï¼š$props is readonly.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$data'</span><span class="token punctuation">,</span> dataDef<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$props'</span><span class="token punctuation">,</span> propsDef<span class="token punctuation">)</span>
</code></pre></div><ul><li>é‚£ä¹ˆ _data å’Œ _props æ˜¯ä»å“ªä¸€æ­¥ä¸­å¾—åˆ°çš„å‘¢ï¼ŸğŸ¤”ï¸</li></ul> <p>å…¶å®åœ¨ä¸Šä¸€æ­¥çš„ initMixin ä¸­ï¼ŒbeforeCreate ç”Ÿå‘½å‘¨æœŸè¿‡åï¼Œæˆ‘ä»¬å°±è°ƒç”¨äº† initState(vm) åˆå§‹åŒ–äº† <strong>propsã€methodsã€dataã€computedã€watch</strong>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// åˆå§‹åŒ– methods computed watchï¼Œçœç•¥ã€‚ã€‚</span>
<span class="token punctuation">}</span>
</code></pre></div><p>initState æ–¹æ³•è°ƒç”¨äº†çš„ initProps å’Œ initData æ–¹æ³•ã€‚ä»–ä»¬é€»è¾‘å¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯éå† propsData æˆ– data çš„æ¯ä¸ª key ä¸ºå…¶æ·»åŠ å“åº”å¼çš„å±æ€§ï¼ŒåŒæ—¶å°† key ä»£ç†åˆ° <code>_props</code> å¯¹è±¡å’Œ <code>_data</code> å¯¹è±¡ä¸­ã€‚</p> <p>å› æ­¤æˆ‘ä»¬åœ¨è°ƒç”¨ initProps å’Œ initData æ–¹æ³•ä¹‹åï¼Œå°±è·å¾—äº† <code>_props</code> å¯¹è±¡å’Œ <code>_data</code> å¯¹è±¡ã€‚æ‰€ä»¥åœ¨ç¬¬äºŒæ­¥çš„ <code>stateMixin</code> ä¸­æˆ‘ä»¬å°±èƒ½ç›´æ¥è¿”å›å®ƒäº†ã€‚</p> <h3 id="set"><a href="#set" class="header-anchor">#</a> $set</h3> <p><code>$set</code> æ–¹æ³•ç›´æ¥ä½¿ç”¨äº† src/core/observer/index ä¸‹çš„ <code>set</code> æ–¹æ³•ã€‚ä»æ–‡ä»¶è·¯å¾„å°±å¯ä»¥çœ‹å‡ºå®ƒä¸å“åº”å¼æœ‰å…³ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$set <span class="token operator">=</span> <span class="token keyword">set</span>
</code></pre></div><p><code>set</code> æ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šç›®æ ‡æ•°ç»„/å¯¹è±¡ã€é”®åã€é”®å€¼ã€‚ç›®çš„æ˜¯ä¸ºäº†å‘æ•°ç»„æˆ–å¯¹è±¡ä¸­æ·»åŠ æ–°çš„å±æ€§ï¼Œå¹¶è§¦å‘å“åº”å¼ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">set</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">target</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span> <span class="token operator">|</span> Object<span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">val</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span>
  <span class="token comment">// éç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä¸èƒ½å‘ undefinedã€nullã€åŸå§‹ç±»å‹ String Number ç­‰è®¾ç½®å±æ€§ï¼Œå¦åˆ™æŠ›å‡ºé”™è¯¯è­¦å‘Š</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPrimitive</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot set reactive property on undefined, null, or primitive value: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>target<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å¦‚æœç›®æ ‡æ˜¯æ•°ç»„å¹¶ä¸”ä¼ å…¥çš„ key æ˜¯åˆæ³•çš„ index å€¼å°±ç”¨ splice ä¿®æ”¹æ•°ç»„</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isValidArrayIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">.</span>length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>length<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    target<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
    <span class="token keyword">return</span> val
  <span class="token punctuation">}</span>
  <span class="token comment">// å¦‚æœç›®æ ‡å¯¹è±¡ä¸­å·²å­˜åœ¨çš„ key å¹¶ä¸”ä¸æ˜¯ Object åŸå‹é“¾ä¸Šçš„å€¼å°±ç›´æ¥ä¿®æ”¹å¯¹è±¡å±æ€§</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> target <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
    <span class="token keyword">return</span> val
  <span class="token punctuation">}</span>
  <span class="token comment">// target æœ‰ __ob__ å±æ€§ï¼ˆæ„å‘³ç€ target ç»§æ‰¿è‡ª Observer ç±»ï¼‰</span>
  <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token punctuation">.</span>__ob__
  <span class="token comment">// _isVue æ˜¯ä¸€ä¸ªé¿å…è¢«è§‚å¯Ÿåˆ°çš„ flagï¼Œè¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª Vue å®ä¾‹ï¼Œåœ¨ initMixin ä¸­å®šä¹‰è¿‡</span>
  <span class="token comment">// vmCount é»˜è®¤å€¼ä¸º 0ï¼Œå¦‚æœæ˜¯ä½œä¸ºæ ¹ç»„ä»¶ï¼Œé‚£ä¹ˆä¼šè‡ªå¢</span>
  <span class="token comment">// æŠ›å‡ºé”™è¯¯ï¼šé¿å…åœ¨è¿è¡Œæ—¶å‘ Vue å®ä¾‹æˆ–ä»–çš„æ ¹ $data æ·»åŠ å“åº”å¼å±æ€§ï¼Œåœ¨ data é€‰é¡¹ä¸­æå‰å£°æ˜å®ƒ</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>_isVue <span class="token operator">||</span> <span class="token punctuation">(</span>ob <span class="token operator">&amp;&amp;</span> ob<span class="token punctuation">.</span>vmCount<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">'Avoid adding reactive properties to a Vue instance or its root $data '</span> <span class="token operator">+</span>
      <span class="token string">'at runtime - declare it upfront in the data option.'</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> val
  <span class="token punctuation">}</span>
  <span class="token comment">// å¦‚æœ target æ²¡æœ‰ __ob__ å±æ€§ï¼Œè¡¨ç¤ºä¸æ˜¯å“åº”å¼å¯¹è±¡ï¼Œè™½ç„¶æ–°çš„å±æ€§ä¼šè¢«è®¾ç½®ï¼Œä½†æ˜¯ä¸ä¼šåšå“åº”å¼å¤„ç†</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
    <span class="token keyword">return</span> val
  <span class="token punctuation">}</span>
  <span class="token comment">// å¯¹äºæ–°å¢çš„å±æ€§æ·»åŠ å“åº”å¼ï¼Œé€šçŸ¥ target çš„è®¢é˜…è€…åˆ—è¡¨è§¦å‘æ›´æ–°</span>
  <span class="token function">defineReactive</span><span class="token punctuation">(</span>ob<span class="token punctuation">.</span>value<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
  ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> val
<span class="token punctuation">}</span>
</code></pre></div><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™äº›ç»“è®ºï¼š</p> <ul><li>ä¸èƒ½å‘ <code>undefined</code>ã€<code>null</code>ã€<code>åŸºæœ¬ç±»å‹ String Number ç­‰</code>è®¾ç½®å±æ€§ï¼Œå¦åˆ™æŠ›å‡ºé”™è¯¯è­¦å‘Šï¼›</li> <li>ä¿®æ”¹æ•°ç»„/å¯¹è±¡ä¸Š<code>å·²å­˜åœ¨</code>çš„å±æ€§åˆ™ç›´æ¥ä¿®æ”¹å€¼ï¼›å¦‚æœæ·»åŠ <code>ä¸å­˜åœ¨</code>çš„å±æ€§ï¼Œé‚£ä¹ˆä¼šä¸ºå±æ€§æ·»åŠ å“åº”å¼å¹¶è§¦å‘æ›´æ–°ï¼›</li> <li>å¦‚æœä¿®æ”¹çš„ç›®æ ‡æœªè¢«å®šä¹‰è¿‡çš„æ•°ç»„/å¯¹è±¡ï¼ˆæœªè¢«è§‚å¯Ÿè¿‡ï¼‰ï¼Œé‚£ä¹ˆè™½ç„¶æ–°çš„å±æ€§ä¼šè¢«è®¾ç½®ï¼Œä½†æ˜¯ä¸ä¼šåšå“åº”å¼å¤„ç†ã€‚</li></ul> <h3 id="delete"><a href="#delete" class="header-anchor">#</a> $delete</h3> <p><code>$delete</code> æ–¹æ³•ç›´æ¥ä½¿ç”¨äº† src/core/observer/index ä¸‹çš„ <code>del</code> æ–¹æ³•ã€‚ä»æ–‡ä»¶è·¯å¾„å°±å¯ä»¥çœ‹å‡ºåˆ é™¤æ“ä½œä¹Ÿä¸å“åº”å¼æœ‰å…³ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$<span class="token keyword">delete</span> <span class="token operator">=</span> del
</code></pre></div><p><code>del</code> æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç›®æ ‡æ•°ç»„/å¯¹è±¡ã€é”®åã€‚ç›®çš„æ˜¯ä¸ºäº†å‘æ•°ç»„æˆ–å¯¹è±¡ä¸­åˆ é™¤å±æ€§ï¼Œå¹¶å¯èƒ½è§¦å‘å“åº”å¼ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">del</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">target</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span> <span class="token operator">|</span> Object<span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ é™¤æœªå®šä¹‰çš„ç›®æ ‡æˆ–è€…æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒæŠ›å‡ºé”™è¯¯ï¼šä¸èƒ½åˆ é™¤ undefind\null\åŸå§‹å€¼çš„å±æ€§</span>
  <span class="token comment">// isUndef() åˆ¤æ–­æ˜¯å¦æ˜¯ undefined æˆ– nullï¼ŒisPrimitive() åˆ¤æ–­æ˜¯å¦æ˜¯ string number symbol boolean</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPrimitive</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot delete reactive property on undefined, null, or primitive value: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>target<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// åˆ é™¤ç›®æ ‡æ˜¯æ•°ç»„å¹¶ä¸”æ˜¯åˆæ³•çš„ indexï¼Œé‚£ä¹ˆç”¨ splice æ“ä½œåˆ é™¤</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isValidArrayIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// åˆ é™¤ç›®æ ‡æ˜¯ Vue å®ä¾‹æˆ–æ˜¯æ ¹ç»„ä»¶ï¼ŒæŠ›å‡ºé”™è¯¯ï¼šé¿å…åˆ é™¤ Vue å®ä¾‹æˆ–æ ¹ç»„ä»¶çš„ $data</span>
  <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token punctuation">.</span>__ob__
  <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>_isVue <span class="token operator">||</span> <span class="token punctuation">(</span>ob <span class="token operator">&amp;&amp;</span> ob<span class="token punctuation">.</span>vmCount<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">'Avoid deleting properties on a Vue instance or its root $data '</span> <span class="token operator">+</span>
      <span class="token string">'- just set it to null.'</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// åˆ é™¤çš„å±æ€§ä¸å±äºç›®æ ‡ï¼Œä¸ä¼šæŠ¥é”™ï¼Œç›´æ¥è¿”å›</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// åˆ é™¤å±æ€§ï¼Œå¦‚æœç›®æ ‡æ•°ç»„/å¯¹è±¡æœªè¢«è§‚å¯Ÿè¿‡å°±ç›´æ¥è¿”å›ï¼Œå¦åˆ™è§¦å‘å“åº”å¼æ›´æ–°</span>
  <span class="token keyword">delete</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™äº›ç»“è®ºï¼š</p> <ul><li>ä¸èƒ½åˆ é™¤ <code>undefined</code> <code>null</code> <code>string</code> <code>number</code> <code>symbol</code> <code>boolean</code>çš„å±æ€§å€¼ï¼Œå¦åˆ™æŠ›å‡ºé”™è¯¯</li> <li>ä¸èƒ½åˆ é™¤ Vue å®ä¾‹æˆ–æ˜¯æ ¹ç»„ä»¶çš„ $dataï¼Œå¦åˆ™æŠ›å‡ºé”™è¯¯</li> <li>åˆ é™¤çš„å±æ€§ä¸å±äºç›®æ ‡ï¼Œä¸ä¼šæœ‰æŠ¥é”™ä¹Ÿä¸ä¼šæœ‰å“åº”</li> <li>åˆ é™¤å±æ€§ï¼Œå¦‚æœç›®æ ‡æ•°ç»„/å¯¹è±¡æœªè¢«å®šä¹‰è¿‡å°±ç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰è§¦å‘å“åº”å¼æ›´æ–°</li></ul> <h3 id="watch"><a href="#watch" class="header-anchor">#</a> $watch</h3> <p><code>$watch</code> æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šè¡¨è¾¾å¼/æ–¹æ³•ã€å›è°ƒå‡½æ•°ã€immediate / deep é€‰é¡¹ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$watch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
    <span class="token comment">// è§‚å¯Ÿ Vue å®ä¾‹ä¸Šçš„ä¸€ä¸ªè¡¨è¾¾å¼æˆ–è€…ä¸€ä¸ªå‡½æ•°è®¡ç®—ç»“æœçš„å˜åŒ–ï¼Œè¡¨è¾¾å¼åªæ¥å—ç®€å•çš„é”®è·¯å¾„ã€‚</span>
    <span class="token comment">// å¯¹äºæ›´å¤æ‚çš„è¡¨è¾¾å¼ï¼Œç”¨ä¸€ä¸ªå‡½æ•°å–ä»£ã€‚</span>
    <span class="token literal-property property">expOrFn</span><span class="token operator">:</span> string <span class="token operator">|</span> Function<span class="token punctuation">,</span> 
    <span class="token literal-property property">cb</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token comment">// å›è°ƒå‡½æ•°çš„å‚æ•°ä¸ºæ–°å€¼å’Œæ—§å€¼</span>
    options<span class="token operator">?</span><span class="token operator">:</span> Object <span class="token comment">// immediate / deep</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">// isPlainObject(cb) åšä¸¥æ ¼å¯¹è±¡çš„ç±»å‹æ£€æŸ¥</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      <span class="token keyword">return</span> <span class="token function">createWatcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> expOrFn<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ç›‘å¬å¯¹è±¡å†…éƒ¨å€¼çš„å˜åŒ–ï¼Œå¯ä»¥åœ¨é€‰é¡¹å‚æ•°ä¸­æŒ‡å®š deep: true æ³¨æ„ï¼Œç›‘å¬æ•°ç»„çš„å˜åŒ–ä¸éœ€è¦è¿™ä¹ˆåš</span>
    <span class="token comment">// åœ¨é€‰é¡¹å‚æ•°ä¸­æŒ‡å®š immediate: true å°†ç«‹å³ä»¥è¡¨è¾¾å¼çš„å½“å‰å€¼è§¦å‘å›è°ƒ</span>
    options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    options<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> expOrFn<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token comment">// å¼€å¯ immediateï¼Œç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°ï¼ŒinvokeWithErrorHandling å¯¹è°ƒç”¨æ–¹æ³•é”™è¯¯æ—¶è¿›è¡Œå¤„ç†</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>immediate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">callback for immediate watcher &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>watcher<span class="token punctuation">.</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span>
      <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">invokeWithErrorHandling</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token punctuation">[</span>watcher<span class="token punctuation">.</span>value<span class="token punctuation">]</span><span class="token punctuation">,</span> vm<span class="token punctuation">,</span> info<span class="token punctuation">)</span>
      <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// watcher.teardown() åŸç†æ˜¯å°† watcher ä»æ‰€æœ‰ç›‘å¬åˆ—è¡¨ä¸­ç§»é™¤ï¼Œå¹¶ç§»é™¤å®ƒçš„è®¢é˜…è€…åˆ—è¡¨</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">unwatchFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      watcher<span class="token punctuation">.</span><span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™äº›ç»“è®ºï¼š</p> <ul><li><code>vm.$watch</code> è¿”å›ä¸€ä¸ªå–æ¶ˆè§‚å¯Ÿå‡½æ•° <code>unwatchFn()</code> æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥åœæ­¢ç›‘å¬ã€‚ä½¿ç”¨æ–¹æ³•ï¼š</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> unwatch <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span> 

<span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å–æ¶ˆè§‚å¯Ÿæ—¶è°ƒç”¨å®ƒ</span>
</code></pre></div><ul><li>ä¸ä»…ä»…å¯ä»¥ç›‘å¬è¡¨è¾¾å¼ï¼Œè¿˜å¯ä»¥ç›‘å¬æ–¹æ³•ï¼š</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// é”®è·¯å¾„ </span>
vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'a.b.c'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token comment">// åšç‚¹ä»€ä¹ˆ </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
<span class="token comment">// å‡½æ•° </span>
vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span> 
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// è¡¨è¾¾å¼ `this.a + this.b` æ¯æ¬¡å¾—å‡ºä¸€ä¸ªä¸åŒçš„ç»“æœæ—¶ï¼Œå¤„ç†å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ã€‚ </span>
    <span class="token comment">// è¿™å°±åƒç›‘å¬ä¸€ä¸ªæœªè¢«å®šä¹‰çš„è®¡ç®—å±æ€§ </span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// åšç‚¹ä»€ä¹ˆ </span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">)</span>
</code></pre></div><h2 id="eventsmixin"><a href="#eventsmixin" class="header-anchor">#</a> eventsMixin</h2> <p><code>eventsMixin</code> å®šä¹‰äº† <code>$on</code> <code>$once</code> <code>$off</code> <code>$emit</code> å››ä¸ªäº‹ä»¶ï¼Œç»“æ„å¾ˆç®€å•ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$on
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$once
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$off
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$emit
</code></pre></div><h3 id="on"><a href="#on" class="header-anchor">#</a> $on</h3> <p><code>vm.$on</code> ç›‘å¬å½“å‰å®ä¾‹ä¸Šçš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œäº‹ä»¶å¯ä»¥ç”± vm.$emit è§¦å‘ã€‚</p> <p><code>vm.$on</code> æ¥å—ä¸¤ä¸ªå‚æ•°ï¼ševent ä»¥åŠå®ƒçš„å›è°ƒå‡½æ•° fnã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$on</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">event</span><span class="token operator">:</span> string <span class="token operator">|</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token literal-property property">fn</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span><span class="token operator">:</span> Component <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">// å½“ event æ˜¯æ•°ç»„æ—¶ï¼Œéå†æ¯ä¸€é¡¹æ‰§è¡Œ else ä¸­çš„é€»è¾‘ã€‚å½“ event æ˜¯ Key æ—¶ï¼Œåˆ™æ”¾å…¥ _events[event] ä¸­ï¼Œç­‰å¾… $emit çš„è§¦å‘</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> event<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span>event<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
      <span class="token comment">// ä¼˜åŒ–é’©å­:åœ¨æ³¨å†Œæ—¶ä½¿ç”¨ _hasHookEvent å¸ƒå°”æ ‡è®°è€Œä¸æ˜¯å“ˆå¸ŒæŸ¥æ‰¾æ¥ä¼˜åŒ–äº‹ä»¶å¼€é”€ã€‚</span>
      <span class="token comment">// optimize hook:event cost by using a boolean flag marked at registration instead of a hash lookup</span>
      
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hookRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// _hasHookEvent = true æ˜¯ç”Ÿå‘½å‘¨æœŸå›è°ƒé’©å­ callHook å‡½æ•°è§¦å‘ $emit('hook:' + hook) çš„å¿…è¦æ¡ä»¶</span>
        <span class="token comment">// åœ¨ lifecycleMixin ä¸­ç”¨åˆ°äº† _hasHookEvent</span>
        vm<span class="token punctuation">.</span>_hasHookEvent <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vm
  <span class="token punctuation">}</span>
</code></pre></div><p>å›è°ƒå‡½æ•° <code>fn</code> ä¼šæ¥æ”¶æ‰€æœ‰ä¼ å…¥äº‹ä»¶è§¦å‘å‡½æ•°çš„é¢å¤–å‚æ•°ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span> 
  vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">)</span> 
  <span class="token comment">// =&gt; &quot;hello&quot;</span>
</code></pre></div><p>Vue.prototype.$on åšäº†ä»€ä¹ˆï¼Ÿ</p> <p>å½“ event æ˜¯<strong>æ•°ç»„</strong>æ—¶ï¼Œéå†æ¯ä¸€é¡¹ç„¶åæ‰§è¡Œ event æ˜¯ <strong>Key</strong> æ—¶çš„é€»è¾‘ã€‚å½“ event æ˜¯ Key æ—¶ï¼Œåˆ™æ”¾å…¥ _events[event] ä¸­ï¼Œç­‰å¾… vm.$emit çš„è§¦å‘åæ‰§è¡Œå›è°ƒå‡½æ•° fnã€‚</p> <h3 id="once"><a href="#once" class="header-anchor">#</a> $once</h3> <p><code>vm.$once</code> ç›‘å¬ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œä½†æ˜¯åªè§¦å‘ä¸€æ¬¡ã€‚ä¸€æ—¦è§¦å‘ä¹‹åï¼Œç›‘å¬å™¨å°±ä¼šè¢«ç§»é™¤ã€‚</p> <p><code>vm.$once</code> æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œevent ä»¥åŠå®ƒçš„å›è°ƒå‡½æ•° fnã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$once</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">event</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">fn</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span><span class="token operator">:</span> Component <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">function</span> <span class="token function">on</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> on<span class="token punctuation">)</span> <span class="token comment">// å…ˆç§»é™¤ç›‘å¬</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span> <span class="token comment">// åå°†å‚æ•°ä¼ ç»™å›è°ƒå‡½æ•°å¹¶æ‰§è¡Œ</span>
    <span class="token punctuation">}</span>
    on<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn
    <span class="token comment">// ä»ç„¶æ‰§è¡Œçš„æ˜¯ $onï¼Œåªæ˜¯åœ¨ $on çš„å›è°ƒå‡½æ•°æ‰§è¡Œä¸­å…ˆç§»é™¤ç›‘å¬ï¼Œå†æ‰§è¡Œæ–¹æ³•ï¼Œä»è€Œè¾¾åˆ°æ‰§è¡Œä¸€æ¬¡çš„æ•ˆæœ</span>
    vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> on<span class="token punctuation">)</span> 
    <span class="token keyword">return</span> vm
  <span class="token punctuation">}</span>
</code></pre></div><p><code>vm.$once</code> ä»ç„¶æ‰§è¡Œçš„æ˜¯ <code>$on</code>ï¼Œåªæ˜¯åœ¨ <code>$on</code> çš„å›è°ƒå‡½æ•°æ‰§è¡Œä¸­å…ˆç§»é™¤ç›‘å¬ï¼Œå†æ‰§è¡Œæ–¹æ³•ï¼Œä»è€Œè¾¾åˆ°æ‰§è¡Œä¸€æ¬¡çš„æ•ˆæœã€‚</p> <h3 id="off"><a href="#off" class="header-anchor">#</a> $off</h3> <p><code>vm.$off</code> ç§»é™¤è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨ã€‚<code>vm.$off</code> æ¥å—ä¸¤ä¸ªå‚æ•°ï¼ševent ä»¥åŠå®ƒçš„å›è°ƒå‡½æ•° fnã€‚</p> <ul><li>å¦‚æœæ²¡æœ‰æä¾›å‚æ•°ï¼Œåˆ™ç§»é™¤æ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼›</li> <li>å¦‚æœåªæä¾›äº†äº‹ä»¶ï¼Œåˆ™ç§»é™¤è¯¥äº‹ä»¶æ‰€æœ‰çš„ç›‘å¬å™¨ï¼›</li> <li>å¦‚æœåŒæ—¶æä¾›äº†äº‹ä»¶ä¸å›è°ƒï¼Œåˆ™åªç§»é™¤è¿™ä¸ªå›è°ƒçš„ç›‘å¬å™¨ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$off</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token operator">?</span><span class="token operator">:</span> string <span class="token operator">|</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span> fn<span class="token operator">?</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span><span class="token operator">:</span> Component <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">// event å’Œ fn éƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ²¡æœ‰æä¾›å‚æ•°ï¼Œåˆ™ç§»é™¤æ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> vm
    <span class="token punctuation">}</span>
    <span class="token comment">// events æ˜¯æ•°ç»„æ—¶ï¼Œéå†æ¯ä¸€é¡¹å¹¶æ‰§è¡Œåé¢çš„é€»è¾‘</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> event<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span>event<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> vm
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> cbs <span class="token operator">=</span> vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span>
    <span class="token comment">// è¯¥äº‹ä»¶çš„å›è°ƒåˆ—è¡¨ä¸ºç©ºï¼Œ$off ä¸åšä»»ä½•å¤„ç†</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cbs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> vm
    <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœæ²¡æœ‰ä¼ å›è°ƒå‡½æ•°ï¼Œåªæä¾›äº†äº‹ä»¶ï¼Œåˆ™ç§»é™¤è¯¥äº‹ä»¶æ‰€æœ‰çš„ç›‘å¬å™¨ï¼ˆå›è°ƒå‡½æ•°ï¼‰ï¼›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">return</span> vm
    <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœä¼ äº†å›è°ƒå‡½æ•°ï¼Œå°±åœ¨è¯¥äº‹ä»¶çš„å›è°ƒå‡½æ•°åˆ—è¡¨ä¸­ç”¨ splice æ–¹æ³•ç§»é™¤è¿™ä¸ªå›è°ƒçš„ç›‘å¬å™¨ã€‚</span>
    <span class="token keyword">let</span> cb
    <span class="token keyword">let</span> i <span class="token operator">=</span> cbs<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cb <span class="token operator">=</span> cbs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cb <span class="token operator">===</span> fn <span class="token operator">||</span> cb<span class="token punctuation">.</span>fn <span class="token operator">===</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cbs<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vm
  <span class="token punctuation">}</span>
</code></pre></div><p><code>vm.$off</code> çš„ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œé‡Œé¢çš„é€»è¾‘åšäº†å¾ˆå¤šè¾¹ç•Œæ¡ä»¶çš„å¤„ç†ï¼Œæ¯”å¦‚ä¸ä¼ å‚æ•°æ—¶åˆ™é‡ç½®ç›‘å¬å™¨åˆ—è¡¨ã€ä¼ æ¥çš„ <code>event</code> æ˜¯å¦æ²¡æœ‰å›è°ƒåˆ—è¡¨ã€<code>event</code> æ˜¯å¦å­˜åœ¨ <code>fn</code> ç­‰ã€‚</p> <h3 id="emit"><a href="#emit" class="header-anchor">#</a> $emit</h3> <p><code>vm.$emit</code> è§¦å‘å½“å‰å®ä¾‹ä¸Šçš„äº‹ä»¶ã€‚é™„åŠ å‚æ•°éƒ½ä¼šä¼ ç»™ç›‘å¬å™¨å›è°ƒã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$emit</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">event</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> Component <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> lowerCaseEvent <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// ä¼ å…¥çš„äº‹ä»¶åæ˜¯é©¼å³°å¹¶ä¸” vm._events å·²ç»æ³¨å†Œäº†å°å†™çš„äº‹ä»¶åæ—¶ï¼Œæç¤ºï¼š</span>
      <span class="token comment">// HTML ä¸åŒºåˆ†å¤§å°å†™ï¼Œv-on ä¸èƒ½ç›‘å¬é©¼å³°å½¢å¼çš„äº‹ä»¶ Keyï¼Œä½ åº”è¯¥ä½¿ç”¨ä¸­åˆ’çº¿æ›¿ä»£é©¼å³°</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>lowerCaseEvent <span class="token operator">!==</span> event <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>lowerCaseEvent<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">tip</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Event &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lowerCaseEvent<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is emitted in component </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">formatComponentName</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> but the handler is registered for &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Note that HTML attributes are case-insensitive and you cannot use </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">v-on to listen to camelCase events when using in-DOM templates. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You should probably use &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">hyphenate</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; instead of &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;.</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> cbs <span class="token operator">=</span> vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cbs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cbs <span class="token operator">=</span> cbs<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token function">toArray</span><span class="token punctuation">(</span>cbs<span class="token punctuation">)</span> <span class="token operator">:</span> cbs
      <span class="token comment">// å°†ç±»æ•°ç»„çš„å¯¹è±¡è½¬åŒ–ä¸ºçœŸæ•°ç»„ï¼Œæ‰§è¡Œå½“å‰å®ä¾‹ä¸Šäº‹ä»¶çš„æ‰€æœ‰å›è°ƒå‡½æ•°</span>
      <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">toArray</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> 
      <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">event handler for &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> cbs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">invokeWithErrorHandling</span><span class="token punctuation">(</span>cbs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vm<span class="token punctuation">,</span> args<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> info<span class="token punctuation">)</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vm
  <span class="token punctuation">}</span>
</code></pre></div><p>ä½¿ç”¨ v-on ç›‘å¬äº‹ä»¶æ—¶è¦ç”¨ä¸­åˆ’çº¿ event-nameï¼Œä¸è¦ä½¿ç”¨é©¼å³° eventNameã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>v<span class="token operator">-</span>on<span class="token operator">:</span>send<span class="token operator">-</span>msg<span class="token operator">=</span><span class="token string">&quot;handleSendMsg&quot;</span> <span class="token comment">// âœ…</span>
v<span class="token operator">-</span>on<span class="token operator">:</span>sendMsg<span class="token operator">=</span><span class="token string">&quot;handleSendMsg&quot;</span> <span class="token comment">// âŒ</span>
</code></pre></div><h2 id="lifecyclemixin"><a href="#lifecyclemixin" class="header-anchor">#</a> lifecycleMixin</h2> <p><code>lifecycleMixin</code> æ–¹æ³•æ˜¯åœ¨ Vue.prototype ä¸Šæ·»åŠ äº† _updateï¼Œ$forceUpdateï¼Œ$destroy æ–¹æ³•ã€‚ç»“æ„å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">lifecycleMixin</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Vue</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_update
    <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$forceUpdate
    <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$destroy
<span class="token punctuation">}</span>
</code></pre></div><h3 id="update"><a href="#update" class="header-anchor">#</a> _update</h3> <p>_update æ˜¯ Vue å®ä¾‹çš„ç§æœ‰æ–¹æ³•ï¼Œä½œç”¨æ˜¯åˆ©ç”¨ patch æ–¹æ³•å°† vnode è½¬åŒ–æˆçœŸå® domã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vnode</span><span class="token operator">:</span> VNode<span class="token punctuation">,</span> hydrating<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> prevEl <span class="token operator">=</span> vm<span class="token punctuation">.</span>$el
    <span class="token keyword">const</span> prevVnode <span class="token operator">=</span> vm<span class="token punctuation">.</span>_vnode
    <span class="token comment">// setActiveInstance æ¥å—ä¸€ä¸ªå®ä¾‹ï¼Œå°†å½“å‰æ¿€æ´»å®ä¾‹è®¾ç½®ä¸ºä¼ æ¥çš„å®ä¾‹ï¼Œè¿”å›ä¸€ä¸ªå°†æ¿€æ´»å®ä¾‹æ¢å¤æˆå‰å®ä¾‹çš„æ–¹æ³•ã€‚</span>
    <span class="token keyword">const</span> restoreActiveInstance <span class="token operator">=</span> <span class="token function">setActiveInstance</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    vm<span class="token punctuation">.</span>_vnode <span class="token operator">=</span> vnode
    <span class="token comment">// Vue.prototype.__patch__ is injected in entry points</span>
    <span class="token comment">// based on the rendering backend used.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// é¦–æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œçš„é€»è¾‘ã€‚</span>
      vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">,</span> <span class="token boolean">false</span> <span class="token comment">/* removeOnly */</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ›´æ–°æ—¶æ‰§è¡Œçš„é€»è¾‘ã€‚</span>
      vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>prevVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å°†æ¿€æ´»å®ä¾‹æ¢å¤æˆå‰å®ä¾‹ã€‚</span>
    <span class="token function">restoreActiveInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// æ›´æ–° __vue__ å¼•ç”¨ã€‚</span>
    <span class="token comment">// æ¸…é™¤å‰ $el çš„ __vue__ å¼•ç”¨ï¼Œ$el çš„ __vue__ ç½®ä¸ºå½“å‰å®ä¾‹ã€‚</span>
    <span class="token comment">// PSï¼šåœ¨ destroyed é˜¶æ®µåä¹Ÿä¼šå°† $el çš„ __vue__ ç½®ä¸º nullã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevEl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      prevEl<span class="token punctuation">.</span>__vue__ <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>$el<span class="token punctuation">.</span>__vue__ <span class="token operator">=</span> vm
    <span class="token punctuation">}</span>
    <span class="token comment">// if parent is an HOC, update its $el as well</span>
    <span class="token comment">// $vnode ä¿å­˜çš„æ˜¯çˆ¶èŠ‚ç‚¹ï¼Œ$parent æ˜¯çˆ¶èŠ‚ç‚¹å®ä¾‹ï¼Œ_vnode ä¿å­˜çš„æ˜¯æ—§èŠ‚ç‚¹ã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$vnode <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$parent <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$vnode <span class="token operator">===</span> vm<span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>_vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>$el <span class="token operator">=</span> vm<span class="token punctuation">.</span>$el
    <span class="token punctuation">}</span>
    <span class="token comment">// åœ¨çˆ¶ç»„ä»¶çš„ updated é’©å­é‡Œï¼Œå­ç»„ä»¶çš„ updated é’©å­ä¹Ÿä¼šè¢«è°ƒåº¦å™¨è°ƒç”¨</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="forceupdate"><a href="#forceupdate" class="header-anchor">#</a> $forceUpdate</h3> <p>è¿«ä½¿ Vue å®ä¾‹é‡æ–°æ¸²æŸ“ã€‚æ³¨æ„å®ƒä»…ä»…å½±å“å®ä¾‹æœ¬èº«å’Œæ’å…¥æ’æ§½å†…å®¹çš„å­ç»„ä»¶ï¼Œè€Œä¸æ˜¯æ‰€æœ‰å­ç»„ä»¶ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$forceUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è°ƒç”¨ core/instance/observer/watcher.js ä¸­çš„ update() æ–¹æ³•</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="destory"><a href="#destory" class="header-anchor">#</a> $destory</h3> <p>å®Œå…¨é”€æ¯ä¸€ä¸ªå®ä¾‹ã€‚æ¸…ç†å®ƒä¸å…¶å®ƒå®ä¾‹çš„è¿æ¥ï¼Œè§£ç»‘å®ƒçš„å…¨éƒ¨æŒ‡ä»¤åŠäº‹ä»¶ç›‘å¬å™¨ã€‚è§¦å‘ <code>beforeDestroy</code> å’Œ <code>destroyed</code> çš„é’©å­ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$destroy</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">// å¦‚æœæ­£åœ¨è¢«é”€æ¯ï¼Œå°±ä¸å†ç»§ç»­æ‰§è¡Œé”€æ¯æ“ä½œï¼Œç›´æ¥è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_isBeingDestroyed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è°ƒç”¨ beforeDestroy ç”Ÿå‘½å‘¨æœŸé’©å­åæ‰“å¼€æ­£åœ¨è¢«é”€æ¯æ ‡å¿—</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeDestroy'</span><span class="token punctuation">)</span>
    vm<span class="token punctuation">.</span>_isBeingDestroyed <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">// çˆ¶å®ä¾‹å­˜åœ¨ã€ä¸”æ²¡æœ‰æ­£åœ¨è¢«é”€æ¯ã€ä¹Ÿä¸æ˜¯æŠ½è±¡ç»„ä»¶å°±ç§»é™¤è‡ªèº«ç»„ä»¶å®ä¾‹</span>
    <span class="token keyword">const</span> parent <span class="token operator">=</span> vm<span class="token punctuation">.</span>$parent
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>parent<span class="token punctuation">.</span>_isBeingDestroyed <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>abstract<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">remove</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$children<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// teardown watchers</span>
    <span class="token comment">// ä»æ‰€æœ‰è®¢é˜…è€…åˆ—è¡¨ä¸­åˆ é™¤è‡ªèº«ï¼Œæ„å‘³ç€ä¸ä¼šå†è¢«è§‚å¯Ÿ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">.</span><span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> vm<span class="token punctuation">.</span>_watchers<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_watchers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// remove reference from data ob</span>
    <span class="token comment">// frozen object may not have observer.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>__ob__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>__ob__<span class="token punctuation">.</span>vmCount<span class="token operator">--</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// __patch__ æ–¹æ³•ä¼ å…¥æ—§èŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹ null ç”¨äºé”€æ¯èŠ‚ç‚¹ï¼Œä¹‹åè°ƒç”¨ destroy é’©å­</span>
    vm<span class="token punctuation">.</span>_isDestroyed <span class="token operator">=</span> <span class="token boolean">true</span>
    vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_vnode<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'destroyed'</span><span class="token punctuation">)</span>

    <span class="token comment">// vm.$off ç§»é™¤è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨ã€‚å¦‚æœæ²¡æœ‰æä¾›å‚æ•°ï¼Œåˆ™ç§»é™¤å®ä¾‹ä¸Šæ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨</span>
    vm<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// ç§»é™¤ __vue__ å¼•ç”¨</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>$el<span class="token punctuation">.</span>__vue__ <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// é‡Šæ”¾å¾ªç¯å¼•ç”¨</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>$vnode<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><code>$destory</code> åšäº†ä»€ä¹ˆï¼Ÿ</p> <ul><li>åˆ¤æ–­äº†å¦‚æœæ˜¯æ­£åœ¨è¢«é”€æ¯çš„ç»„ä»¶æ‰§è¡Œäº† $destoryï¼Œå°†ä¸ä¼šæ‰§è¡Œé”€æ¯æ“ä½œã€‚</li> <li>è§¦å‘äº† <code>beforeDestroy</code> ç”Ÿå‘½å‘¨æœŸã€‚</li> <li>ä»çˆ¶ç»„ä»¶çš„ $children ä¸­åˆ é™¤è‡ªèº«å®ä¾‹ã€‚</li> <li>ä»è®¢é˜…è€…åˆ—è¡¨ _watchers ä¸­ç§»é™¤è‡ªèº«å®ä¾‹ã€‚</li> <li>ç”¨ __ patch __ æ–¹æ³•é”€æ¯èŠ‚ç‚¹ã€‚</li> <li>è§¦å‘äº† <code>destroyed</code> ç”Ÿå‘½å‘¨æœŸã€‚</li> <li>ä½¿ç”¨ vm.$off æ–¹æ³•ç§»é™¤å®ä¾‹ä¸Šæ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ã€‚</li></ul> <h2 id="rendermixin"><a href="#rendermixin" class="header-anchor">#</a> renderMixin</h2> <p>renderMixin ç»™ Vue.prototype æ·»åŠ äº†è®¸å¤š runtime helpers æ–¹æ³•ã€$nextTickã€_render æ–¹æ³•ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">renderMixin</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Vue</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">installRenderHelpers</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$nextTick
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_render
<span class="token punctuation">}</span>
</code></pre></div><p>installRenderHelpers ä¸º Vue.prototype æ·»åŠ äº†è®¸å¤šæ–¹æ³•ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">installRenderHelpers</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">target</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">.</span>_o <span class="token operator">=</span> markOnce <span class="token comment">// ä½¿ç”¨å”¯ä¸€ key å°†èŠ‚ç‚¹æ ‡è®°ä¸ºé™æ€</span>
  target<span class="token punctuation">.</span>_n <span class="token operator">=</span> toNumber <span class="token comment">// å­—ç¬¦ä¸²è½¬æˆæ•°å­—ï¼Œå¤±è´¥çš„è¯è¿”å›åŸå€¼</span>
  target<span class="token punctuation">.</span>_s <span class="token operator">=</span> toString <span class="token comment">// å°†ä»»ä½•ç±»å‹çš„å€¼è½¬æˆå­—ç¬¦ä¸²</span>
  target<span class="token punctuation">.</span>_l <span class="token operator">=</span> renderList <span class="token comment">// æ¸²æŸ“ v-for åˆ—è¡¨ï¼Œè¿”å›ä¸€ä¸ª VNode ç»„æˆçš„æ•°ç»„</span>
  target<span class="token punctuation">.</span>_t <span class="token operator">=</span> renderSlot <span class="token comment">// æ¸²æŸ“ &lt;slot&gt;ï¼Œè¿”å›ä¸€ä¸ª VNode ç»„æˆçš„æ•°ç»„</span>
  target<span class="token punctuation">.</span>_q <span class="token operator">=</span> looseEqual <span class="token comment">// åˆ¤æ–­ä»»æ„ç±»å‹æ˜¯å¦æ¾æ•£ç›¸ç­‰</span>
  target<span class="token punctuation">.</span>_i <span class="token operator">=</span> looseIndexOf <span class="token comment">// è·å–æ•°ç»„ä¸­ä¸å‚æ•°ç›¸ç­‰çš„å€¼çš„ä¸‹æ ‡</span>
  target<span class="token punctuation">.</span>_m <span class="token operator">=</span> renderStatic <span class="token comment">// ä¼˜å…ˆè·å–ç¼“å­˜æ¸²æŸ“æ ‘ï¼Œå…¶æ¬¡è¿”å›ä¸€ä¸ªæ–°çš„æ¸²æŸ“æ ‘</span>
  target<span class="token punctuation">.</span>_f <span class="token operator">=</span> resolveFilter <span class="token comment">// å¤„ç†è¿‡æ»¤å™¨ï¼Œè¿”å› this.$options['filters'][id]</span>
  target<span class="token punctuation">.</span>_k <span class="token operator">=</span> checkKeyCodes <span class="token comment">// æ ¡éªŒ eventKeyCode æ–¹æ³•</span>
  target<span class="token punctuation">.</span>_b <span class="token operator">=</span> bindObjectProps <span class="token comment">// åˆå¹¶ v-bind=&quot;object&quot; åˆ° VNode çš„ data ä¸­</span>
  target<span class="token punctuation">.</span>_v <span class="token operator">=</span> createTextVNode <span class="token comment">// åˆ›å»ºå­—ç¬¦ä¸²èŠ‚ç‚¹</span>
  target<span class="token punctuation">.</span>_e <span class="token operator">=</span> createEmptyVNode <span class="token comment">// åˆ›å»ºç©ºèŠ‚ç‚¹ï¼Œå¯ä»¥ä¼ å…¥ text</span>
  target<span class="token punctuation">.</span>_u <span class="token operator">=</span> resolveScopedSlots <span class="token comment">// å¤„ç† scoped slots</span>
  target<span class="token punctuation">.</span>_g <span class="token operator">=</span> bindObjectListeners
  target<span class="token punctuation">.</span>_d <span class="token operator">=</span> bindDynamicKeys <span class="token comment">// ç»‘å®šåŠ¨æ€ keyï¼Œ&lt;div :[key]=&quot;value&quot;&gt;</span>
  target<span class="token punctuation">.</span>_p <span class="token operator">=</span> prependModifier <span class="token comment">//åŠ¨æ€æ·»åŠ ä¿®é¥°å™¨è¿è¡Œæ ‡è®°åˆ°äº‹ä»¶åç§°ä¸Š</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="nexttick"><a href="#nexttick" class="header-anchor">#</a> $nextTick</h3> <p><code>$nextTick</code> å°†å›è°ƒå»¶è¿Ÿåˆ°ä¸‹æ¬¡ DOM æ›´æ–°å¾ªç¯ä¹‹åæ‰§è¡Œã€‚<code>$nextTick</code> æ¶‰åŠåˆ°äº†äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œæºç åœ¨ <code>src/core/util/next-tick.js</code> ä¸­ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$nextTick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">fn</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">nextTick</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span> <span class="token punctuation">(</span><span class="token parameter">cb<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> ctx<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _resolve
  callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> <span class="token string">'nextTick'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">_resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// timerFunc ä¼˜å…ˆä½¿ç”¨ Promiseã€MutationObserverã€setImmediateï¼Œæœ€åä½¿ç”¨ setTimeout æ‰§è¡Œ callbacks æ•°ç»„ä¸­çš„å›è°ƒå‡½æ•°ã€‚</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pending <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token function">timerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è¿™æ˜¯å½“ nextTick ä¸ä¼  cb å‚æ•°çš„æ—¶å€™ï¼Œæä¾›ä¸€ä¸ª Promise åŒ–çš„è°ƒç”¨ï¼Œæ¯”å¦‚ï¼šnextTick().then(() =&gt; {})</span>
  <span class="token comment">// å½“ _resolve å‡½æ•°æ‰§è¡Œï¼Œå°±ä¼šè·³åˆ° then çš„é€»è¾‘ä¸­ã€‚</span>
  <span class="token comment">// $flow-disable-line</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      _resolve <span class="token operator">=</span> resolve
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Vue åœ¨å†…éƒ¨å¯¹å¼‚æ­¥é˜Ÿåˆ—å°è¯•ä½¿ç”¨åŸç”Ÿçš„Â <code>Promise.then</code>ã€<code>MutationObserver</code>Â å’ŒÂ <code>setImmediate</code>ï¼Œå¦‚æœæ‰§è¡Œç¯å¢ƒä¸æ”¯æŒï¼Œåˆ™ä¼šé‡‡ç”¨Â <code>setTimeout(fn, 0)</code>Â ä»£æ›¿ã€‚</p> <p><code>Promise</code> å’Œ <code>MutationObserver</code> å±äºå¾®ä»»åŠ¡ï¼Œä½†ä»–ä»¬çš„å…¼å®¹æ€§æœ‰é—®é¢˜ï¼ˆPromise éœ€è¦ç¯å¢ƒæ”¯æŒï¼ŒMutationObserver éœ€è¦åœ¨ IE 11+ ä¸­ï¼‰ï¼Œ<code>setImmediate</code> å’Œ <code>setTimeout</code> å±äºå®ä»»åŠ¡ï¼ˆä½† setImmediate åªæœ‰åœ¨æœ€æ–°ç‰ˆæœ¬çš„Â IE å’ŒNode.js 0.10+ å®ç°äº†è¯¥æ–¹æ³•ï¼‰ã€‚IEï¼šä½ çœ‹æˆ‘å¹²å˜›ï¼Ÿå…³äº Vue çš„é™çº§ç­–ç•¥ï¼Œæ¨èçœ‹è¿™ç¯‡æ–‡ç«  <a href="https://mp.weixin.qq.com/s?__biz=Mzg4MTYwMzY1Mw==&amp;mid=2247495702&amp;idx=1&amp;sn=757a0817674daedb86fb9eb34c657a2d&amp;source=41#wechat_redirect" target="_blank" rel="noopener noreferrer"># å…¨é¢è§£æVue.nextTickå®ç°åŸç†<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <h3 id="render"><a href="#render" class="header-anchor">#</a> _render</h3> <p>_render æ˜¯ Vue å®ä¾‹çš„ç§æœ‰æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ª Vnodeã€‚å®ƒè°ƒç”¨äº†å¤–éƒ¨ä¼ å…¥çš„ render å’Œ renderError æ–¹æ³•ã€‚</p> <p>Vue é€‰é¡¹ä¸­çš„Â <code>render</code>Â å‡½æ•°è‹¥å­˜åœ¨ï¼Œåˆ™ Vue æ„é€ å‡½æ•°<strong>ä¸ä¼š</strong>ä»Â <code>template</code>Â é€‰é¡¹æˆ–é€šè¿‡Â <code>el</code>Â é€‰é¡¹æŒ‡å®šçš„æŒ‚è½½å…ƒç´ ä¸­æå–å‡ºçš„ HTML æ¨¡æ¿ç¼–è¯‘æ¸²æŸ“å‡½æ•°ã€‚è€Œæ˜¯æ¥æ”¶ä¸€ä¸ªÂ <code>createElement</code>Â æ–¹æ³•ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ç”¨æ¥åˆ›å»ºÂ <code>VNode</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> _parentVnode <span class="token punctuation">}</span> <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options

    <span class="token comment">// å¦‚æœçˆ¶ç»„ä»¶å­˜åœ¨ï¼Œè¡¨ç¤ºè¯¥å®ä¾‹æ˜¯å­ç»„ä»¶ã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_parentVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ä½œç”¨åŸŸæ’æ§½ `vm.$scopedSlots`ï¼Œç”¨æ¸²æŸ“å‡½æ•°å‘å­ç»„ä»¶ä¸­ä¼ é€’ä½œç”¨åŸŸæ’æ§½ï¼Œä½¿æ’æ§½å†…å®¹èƒ½å¤Ÿè®¿é—®å­ç»„ä»¶ä¸­æ‰æœ‰çš„æ•°æ®ã€‚</span>
      vm<span class="token punctuation">.</span>$scopedSlots <span class="token operator">=</span> <span class="token function">normalizeScopedSlots</span><span class="token punctuation">(</span>
        _parentVnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>scopedSlots<span class="token punctuation">,</span>
        vm<span class="token punctuation">.</span>$slots<span class="token punctuation">,</span>
        vm<span class="token punctuation">.</span>$scopedSlots
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è®¾ç½®çˆ¶èŠ‚ç‚¹ vnodeã€‚</span>
    vm<span class="token punctuation">.</span>$vnode <span class="token operator">=</span> _parentVnode
    <span class="token comment">// å¼€å§‹æ¸²æŸ“èŠ‚ç‚¹ï¼Œå¦‚æœ render å‡½æ•°å‡ºé”™æˆ–æ˜¯ renderError å‡½æ•°ä¹Ÿå‡ºé”™ï¼Œå…œåº•æ–¹æ¡ˆæ˜¯è¿”å›å‰ä¸€ä¸ª vnodeã€‚</span>
    <span class="token keyword">let</span> vnode
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      currentRenderingInstance <span class="token operator">=</span> vm
      vnode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_renderProxy<span class="token punctuation">,</span> vm<span class="token punctuation">.</span>$createElement<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">render</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token comment">// renderError å‡½æ•°åªåœ¨å¼€å‘ç¯å¢ƒä¸‹å·¥ä½œã€‚</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>renderError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">// Vue é€‰é¡¹ä¸­çš„ `renderError` å‡½æ•°è‹¥å­˜åœ¨ï¼Œå½“ render å‡½æ•°é­é‡é”™è¯¯æ—¶ï¼Œæä¾›å¦å¤–ä¸€ç§æ¸²æŸ“è¾“å‡ºã€‚</span>
          vnode <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span><span class="token function">renderError</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_renderProxy<span class="token punctuation">,</span> vm<span class="token punctuation">.</span>$createElement<span class="token punctuation">,</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">renderError</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
          vnode <span class="token operator">=</span> vm<span class="token punctuation">.</span>_vnode
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        vnode <span class="token operator">=</span> vm<span class="token punctuation">.</span>_vnode
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      currentRenderingInstance <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// render å‡½æ•°è¿”å›æ•°ç»„ä¸”åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œè®© vnode ç­‰äºè¿™ä¸ªå€¼ã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vnode <span class="token operator">=</span> vnode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// render å‡½æ•°å‡ºé”™çš„æƒ…å†µä¸‹ï¼Œè¿”å›ç©º vnodeã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>vnode <span class="token keyword">instanceof</span> <span class="token class-name">VNode</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¼€å‘ç¯å¢ƒä¸‹ï¼Œå¦‚æœä¼ å…¥çš„ä¸æ˜¯åªæœ‰ä¸€ä¸ªæ ¹ç»“ç‚¹ï¼Œå°±æŠ›å‡ºé”™è¯¯è­¦å‘Šã€‚</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token string">'Multiple root nodes returned from render function. Render function '</span> <span class="token operator">+</span>
          <span class="token string">'should return a single root node.'</span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      vnode <span class="token operator">=</span> <span class="token function">createEmptyVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// set parent</span>
    vnode<span class="token punctuation">.</span>parent <span class="token operator">=</span> _parentVnode
    <span class="token keyword">return</span> vnode
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p>å®ä¾‹æ–¹æ³•ä¸­å®šä¹‰äº†å¾ˆå¤šè¾¹ç•Œæ¡ä»¶çš„åˆ¤æ–­ï¼Œå¹¶æŠ›å‡ºé”™è¯¯ï¼Œé€šè¿‡è¿™äº›é”™è¯¯å¤„ç†å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…åœ¨å¼€å‘æ—¶å†™å‡º bugï¼Œé˜…è¯»æºç åŒæ—¶å¯ä»¥å’Œ <a href="https://cn.vuejs.org/v2/api/#%E5%AE%9E%E4%BE%8B-property" target="_blank" rel="noopener noreferrer">API æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¸€èµ·é˜…è¯»ï¼Œèƒ½å¤Ÿæ›´å…·ä½“çš„ç†è§£æ–¹æ³•ä¸­å‚æ•°çš„ä½œç”¨ï¼Œä¹Ÿæœ‰åŠ©äºæŒæ¡å®ä¾‹æ–¹æ³•çš„ä½¿ç”¨ã€‚</p> <p>å› ä¸ºæœ€è¿‘åœ¨çœ‹Â <code>Vue.js</code>Â çš„æºç ï¼Œæ‰€æœ‰å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°å’Œæ€»ç»“éƒ½ä¼šè®°å½•åœ¨æˆ‘çš„Â <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FGesj-yean%2Fvue-demo-collection" title="https://github.com/Gesj-yean/vue-demo-collection" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>Â ä¸­ï¼Œæ„Ÿè°¢å…³æ³¨~</p> <p>PSï¼šå¦‚æœæ–‡ç« ä¸­å­˜åœ¨é”™è¯¯è¯·å¤§ä½¬ä»¬æŒ‡å‡ºï¼</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/vue-demo-collection/note/vue2/part3-entry.html" class="prev">
        part3 - Vue.js å…¥å£æ–‡ä»¶åˆ†æ
      </a></span> <span class="next"><a href="/vue-demo-collection/note/js/garbage-collection.html">
        åƒåœ¾å›æ”¶
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vue-demo-collection/assets/js/app.f5b96e8e.js" defer></script><script src="/vue-demo-collection/assets/js/7.ac4e68a0.js" defer></script><script src="/vue-demo-collection/assets/js/80.c5fc458b.js" defer></script>
  </body>
</html>
