<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue.js + Rollup æ„å»º | Vue-Demo-Collection</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="A documentation of the excellent components encountered in VUE development">
    
    <link rel="preload" href="/vue-demo-collection/assets/css/0.styles.41da42df.css" as="style"><link rel="preload" href="/vue-demo-collection/assets/js/app.f5b96e8e.js" as="script"><link rel="preload" href="/vue-demo-collection/assets/js/7.ac4e68a0.js" as="script"><link rel="preload" href="/vue-demo-collection/assets/js/78.ffce0429.js" as="script"><link rel="prefetch" href="/vue-demo-collection/assets/js/1.2e2b4322.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/10.6fe83197.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/11.607bf541.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/12.240a3ba2.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/13.5f3ec41a.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/14.c64dd16f.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/15.04283614.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/16.833af79b.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/17.4daaa688.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/18.088bf1a8.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/19.b9758386.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/2.2d5faf37.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/20.3b799ac1.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/21.ac51364b.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/22.c44a5a8f.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/23.75b8ffb8.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/24.7553e43b.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/25.cd523bbf.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/26.b58a03fa.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/27.e4741fa3.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/28.9dbdb2e3.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/29.1c444fa8.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/3.da5e3f9c.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/30.d656d726.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/31.ae9630e4.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/32.8a6fd8e6.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/33.877edd59.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/34.a357b142.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/35.2d0c38e2.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/36.18bacde9.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/37.186a837c.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/38.f2fc3138.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/39.dabd2123.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/4.20b3f9b2.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/40.c511b4c2.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/41.4cad3d23.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/42.9136ea93.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/43.9678c4e1.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/44.09158630.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/45.76503459.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/46.756f2a47.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/47.fa58ae45.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/48.9b745272.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/49.d1bf558f.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/5.90b8032d.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/50.ac5f466d.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/51.38a211b6.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/52.960e4db6.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/53.73267aeb.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/54.434a97c0.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/55.57400b27.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/56.e828cd7c.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/57.794280cf.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/58.e0e41a13.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/59.374c4057.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/60.a292140c.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/61.d6e64963.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/62.951cb72d.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/63.ab7ebef5.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/64.ea299191.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/65.35bb57b8.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/66.96b69f7d.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/67.9f43214c.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/68.acad029f.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/69.4dd36d2f.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/70.8514f7a6.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/71.a1e6d21e.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/72.85e4760a.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/73.82d83fb8.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/74.94a16f58.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/75.c1fdfff9.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/76.6dbd6ea2.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/77.431a65f0.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/79.a8b30c75.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/8.7b37b1dc.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/80.c5fc458b.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/81.294e85c3.js"><link rel="prefetch" href="/vue-demo-collection/assets/js/9.7075ed80.js">
    <link rel="stylesheet" href="/vue-demo-collection/assets/css/0.styles.41da42df.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue-demo-collection/" class="home-link router-link-active"><img src="/vue-demo-collection/logo.png" alt="Vue-Demo-Collection" class="logo"> <span class="site-name can-hide">Vue-Demo-Collection</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-demo-collection/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/vue-demo-collection/base/" class="nav-link">
  ç»„ä»¶
</a></div><div class="nav-item"><a href="/vue-demo-collection/note/" class="nav-link router-link-active">
  ç¬”è®°
</a></div><div class="nav-item"><a href="/vue-demo-collection/essays/" class="nav-link">
  éšç¬”
</a></div><div class="nav-item"><a href="https://github.com/Gesj-yean/vue-demo-collection" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-demo-collection/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/vue-demo-collection/base/" class="nav-link">
  ç»„ä»¶
</a></div><div class="nav-item"><a href="/vue-demo-collection/note/" class="nav-link router-link-active">
  ç¬”è®°
</a></div><div class="nav-item"><a href="/vue-demo-collection/essays/" class="nav-link">
  éšç¬”
</a></div><div class="nav-item"><a href="https://github.com/Gesj-yean/vue-demo-collection" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/vue-demo-collection/note/" class="sidebar-heading clickable router-link-active open"><span>Vue2 æºç å­¦ä¹ </span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-demo-collection/note/vue2/part1-start.html" class="sidebar-link">part1 - åŸºæœ¬çŸ¥è¯†ï¼šFlow</a></li><li><a href="/vue-demo-collection/note/vue2/part2-build.html" aria-current="page" class="active sidebar-link">part2 - Vue + Rollup æ„å»ºè¿‡ç¨‹</a></li><li><a href="/vue-demo-collection/note/vue2/part3-entry.html" class="sidebar-link">part3 - Vue.js å…¥å£æ–‡ä»¶åˆ†æ</a></li><li><a href="/vue-demo-collection/note/vue2/part4-method.html" class="sidebar-link">part4 - å®ä¾‹æ–¹æ³•</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/vue-demo-collection/note/js/" class="sidebar-heading clickable"><span>Javascript é«˜çº§ç¨‹åºè®¾è®¡</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-demo-collection/note/js/garbage-collection.html" class="sidebar-link">åƒåœ¾å›æ”¶</a></li><li><a href="/vue-demo-collection/note/js/map.html" class="sidebar-link">Map</a></li><li><a href="/vue-demo-collection/note/js/set.html" class="sidebar-link">Set</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-js-rollup-æ„å»º"><a href="#vue-js-rollup-æ„å»º" class="header-anchor">#</a> Vue.js + Rollup æ„å»º</h1> <blockquote><p>æ­¤éƒ¨åˆ†ä¸º <code>Vue.js</code> æºç å­¦ä¹ è¿‡ç¨‹ä¸­çš„æ€»ç»“ï¼Œå»ºè®®å¯¹ç…§æºç ä¸­ <code>scripts/build.js</code> ä¸€èµ·çœ‹~</p></blockquote> <p>å½“ä½ è¾“å…¥ <code>npm run build</code> å‘½ä»¤ï¼Œ <code>Vue.js</code> æ„å»ºè¿‡ç¨‹å°±ä¼šä»è¿è¡Œ <code>&quot;build&quot;: &quot;node scripts/build.js&quot;</code> å¼€å§‹ï¼Œå®ƒçš„å…¥å£ä¸º <code>scripts/build.js</code> æ–‡ä»¶ã€‚æˆ‘ä»¬ä¸€èµ·ä» <code>build.js</code> å¼€å§‹åˆ†æï¼Œç‚¹è¿™é‡Œæ‰“å¼€æºç  <a href="https://github.com/vuejs/vue/blob/dev/scripts/build.js" target="_blank" rel="noopener noreferrer">build.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ã€‚</p> <h2 id="build-js"><a href="#build-js" class="header-anchor">#</a> build.js</h2> <p>åœ¨çœ‹æ–‡ä»¶çš„æºç æ—¶å»ºè®®å…ˆå»çœ‹å¼•å…¥äº†å“ªäº›æ¨¡å—ï¼Œæœ‰ä¸ªå°è±¡ï¼Œç„¶åè¯»ä»£ç æ—¶ä¼šæ›´å¿«çš„ç†è§£ã€‚</p> <p>é¦–å…ˆåœ¨ <code>build.js</code> æ–‡ä»¶çš„å¼€å¤´æ¥çœ‹çœ‹å¼•å…¥äº†å“ªäº›å˜é‡ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> zlib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'zlib'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> rollup <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> terser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser'</span><span class="token punctuation">)</span>
</code></pre></div><p><code>fs</code> æ˜¯ node.js ä¸­çš„æ–‡ä»¶ç³»ç»Ÿï¼›<code>path</code> æ¨¡å—æä¾›äº†ç”¨äºå¤„ç†æ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„çš„å®ç”¨å·¥å…·ï¼›<code>zlib</code> æ¨¡å—æä¾›äº†ä½¿ç”¨ Gzipã€Deflate/Inflateã€ä»¥åŠ Brotli å®ç°çš„å‹ç¼©åŠŸèƒ½ï¼›<code>Rollup</code> æ˜¯ä¸€ä¸ª JavaScript æ¨¡å—æ‰“åŒ…å™¨ï¼›<code>Terser</code> ç”¨äºå‹ç¼©ç”Ÿäº§ç¯å¢ƒä¸‹çš„è¾“å‡ºç»“æœã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ¥ç€ï¼Œæ‰§è¡Œäº†ä¸Šè¿°ä»£ç ï¼Œåˆ¤æ–­äº†æ˜¯å¦å­˜åœ¨ <code>dist</code> ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ª <code>dist</code> ç›®å½•ã€‚ä¹‹åæ˜¯è·å–æ‰“åŒ…çš„èµ„æºï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> builds <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAllBuilds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><code>getAllBuilds</code> æ˜¯ <code>config.js</code> æ–‡ä»¶çš„æ–¹æ³•ï¼Œç›®çš„æ˜¯è¾“å‡ºæ‰€æœ‰ <code>build</code> é”®å€¼å¯¹å¯¹åº”çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡æ˜¯ <code>rollup</code> æ„å»ºæ—¶éœ€è¦çš„å‚æ•°å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ <code>builds</code> è·å¾—äº†å…¨éƒ¨æƒ…å†µä¸‹æ‰“åŒ…å¯¹è±¡çš„æ•°ç»„åˆé›†ã€‚å…·ä½“å¯¹è±¡çš„å†…å®¹åœ¨ä¸‹æ–‡ <code>config.js</code> ä¸­æœ‰æè¿°ï¼Œå…ˆä¸å¤šè¯´å•¦ã€‚</p> <p>åœ¨è·å–åˆ°å…¨éƒ¨æ„å»ºä¿¡æ¯åï¼Œå°±å¯ä»¥æ ¹æ®ä½ è¾“å…¥çš„å‘½ä»¤æ¥åˆ¤æ–­è¯¥ç”Ÿæˆä»€ä¹ˆæ ·çš„æ‰“åŒ…æ–‡ä»¶ã€‚</p> <p><strong>è¿™é‡Œå…ˆäº†è§£ä¸€äº›é¢„å¤‡çŸ¥è¯†</strong>ï¼š<code>process</code> å¯¹è±¡æä¾›æœ‰å…³å½“å‰ Node.js è¿›ç¨‹çš„ä¿¡æ¯å¹¶å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚<code>process.argv</code> å±æ€§è¿”å›æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«å¯åŠ¨ <code>Node.js</code> è¿›ç¨‹æ—¶ä¼ å…¥çš„å‘½ä»¤è¡Œå‚æ•°ã€‚ ç¬¬ä¸€ä¸ªå…ƒç´ å°†æ˜¯ <code>process.execPath</code>ã€‚ç¬¬äºŒä¸ªå…ƒç´ å°†æ˜¯æ­£åœ¨æ‰§è¡Œçš„ JavaScript æ–‡ä»¶çš„è·¯å¾„ã€‚ å…¶ä½™å…ƒç´ å°†æ˜¯ä»»ä½•å…¶ä»–å‘½ä»¤è¡Œå‚æ•°ã€‚</p> <p>å†æ¥çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// filter builds via command line arg</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> filters <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
  builds <span class="token operator">=</span> builds<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> filters<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>output<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> b<span class="token punctuation">.</span>_name<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// filter out weex builds by default</span>
  builds <span class="token operator">=</span> builds<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> b<span class="token punctuation">.</span>output<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'weex'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬æ‰§è¡Œ <code>npm run build</code> èµ°çš„æ˜¯ <code>else</code> ä¸­çš„é€»è¾‘ï¼Œä¼šå¸®æˆ‘ä»¬è¿‡æ»¤æ‰ weex çš„æ‰“åŒ…ï¼Œä¸ä¼šç”Ÿæˆ weex çš„æ‰“åŒ…æ–‡ä»¶ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ <code>build:ssr</code> æˆ– <code>build:weex</code> çš„è¯ï¼Œå®é™…åœ¨ <code>package.json</code> ä¸­æ‰§è¡Œçš„æ˜¯ npm run build -- web-runtime-cjs,web-server-renderer å’Œ npm run build -- weexï¼Œå°±ä¼šèµ° <code>if</code> ä¸­çš„é€»è¾‘ï¼Œå¾—åˆ° ssr æˆ– weex çš„ rollup æ‰“åŒ…ä¿¡æ¯æ•°ç»„ã€‚</strong></p> <p>æœ€ç»ˆè·å¾—çš„ <code>builds</code> æ•°ç»„ä¿¡æ¯æ ¼å¼å¦‚ä¸‹ğŸ‘‡ï¼š</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/63aa952163af4c4888d4da7e21934dcc~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <p>å…ˆè®°ä½ä¸Šé¢ <code>build</code> å¯¹è±¡ä¸­åŒ…å«äº† <strong>inputã€externalã€pluginsã€outputï¼ˆfileã€formatã€bannerã€nameï¼‰ã€onwarn</strong> è¿™äº›ä¿¡æ¯ã€‚æ¥ä¸‹æ¥å°±è½®åˆ° <code>Rollup</code> ä¸Šåœºå¼€å§‹é€ä¸€æ‰“åŒ…æ„å»ºçš„è¿‡ç¨‹ ğŸ‘‡ã€‚</p> <p><code>build</code> ä¾æ¬¡è°ƒç”¨äº† <code>buildEntry</code> æ–¹æ³•ï¼Œ<code>buildEntry</code> æ–¹æ³•ä¸­ä½¿ç”¨äº† <code>rollup.rollup API</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">build</span><span class="token punctuation">(</span>builds<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">build</span> <span class="token punctuation">(</span><span class="token parameter">builds</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> built <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">const</span> total <span class="token operator">=</span> builds<span class="token punctuation">.</span>length
  <span class="token keyword">const</span> <span class="token function-variable function">next</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">buildEntry</span><span class="token punctuation">(</span>builds<span class="token punctuation">[</span>built<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      built<span class="token operator">++</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>built <span class="token operator">&lt;</span> total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>logError<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">buildEntry</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> output <span class="token operator">=</span> config<span class="token punctuation">.</span>output
  <span class="token keyword">const</span> <span class="token punctuation">{</span> file<span class="token punctuation">,</span> banner <span class="token punctuation">}</span> <span class="token operator">=</span> output
  <span class="token keyword">const</span> isProd <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(min|prod)\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
  <span class="token keyword">return</span> rollup<span class="token punctuation">.</span><span class="token function">rollup</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">bundle</span> <span class="token operator">=&gt;</span> bundle<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> code <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isProd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> minified <span class="token operator">=</span> <span class="token punctuation">(</span>banner <span class="token operator">?</span> banner <span class="token operator">+</span> <span class="token string">'\n'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> terser<span class="token punctuation">.</span><span class="token function">minify</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">toplevel</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">ascii_only</span><span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">pure_funcs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'makeMap'</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>code
        <span class="token keyword">return</span> <span class="token function">write</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> minified<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">write</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> code<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>çœ‹ä¸Šé¢çš„ <code>buildEntry</code> æ–¹æ³•ï¼Œ<a href="https://www.rollupjs.com/guide/javascript-api" target="_blank" rel="noopener noreferrer">rollup.rollup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>Â å‡½æ•°è¿”å›ä¸€ä¸ª <code>Promise</code>ï¼Œå®ƒè§£æäº†ä¸€ä¸ªÂ <code>bundle</code>Â å¯¹è±¡ï¼Œå†è°ƒç”¨ <code>bundle.generate</code> ç”Ÿæˆ <code>code</code>ï¼ˆcode æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ–‡ä»¶åä¸º keyï¼Œ æºç ä¸º valueï¼‰å¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œä¼šäº¤ç»™ <code>terser.minify()</code> è·å¾—å‹ç¼©åçš„ä»£ç ã€‚</p> <p>å†…éƒ¨è¿˜è°ƒç”¨äº† writeã€getSizeã€logErrorã€blue ç­‰ä¸€äº›å…¶ä»–æ–¹æ³•ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">write</span> <span class="token punctuation">(</span><span class="token parameter">dest<span class="token punctuation">,</span> code<span class="token punctuation">,</span> zip</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">report</span> <span class="token punctuation">(</span><span class="token parameter">extra</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">blue</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token function">getSize</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>extra <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> code<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>zip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        zlib<span class="token punctuation">.</span><span class="token function">gzip</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> zipped</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
          <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">' (gzipped: '</span> <span class="token operator">+</span> <span class="token function">getSize</span><span class="token punctuation">(</span>zipped<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getSize</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>code<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'kb'</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">logError</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">blue</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'\x1b[1m\x1b[34m'</span> <span class="token operator">+</span> str <span class="token operator">+</span> <span class="token string">'\x1b[39m\x1b[22m'</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>write</code> æ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šç›®æ ‡æ–‡ä»¶ destï¼Œå†…å®¹ codeï¼Œå¼€å¯å‹ç¼© zipã€‚<code>fs.writeFile</code> å¼‚æ­¥åœ°å°†æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™æ›¿æ¢è¯¥æ–‡ä»¶ã€‚å…¶ä¸­è¿˜å®šä¹‰äº†ä¸€äº›æ–¹æ³•ä¾¿äºæŸ¥çœ‹ <code>log</code> ä¿¡æ¯ï¼Œ<code>getSize</code> å’Œ <code>blue</code> ä¼šåœ¨è¿è¡Œå‘½ä»¤æ—¶çš„æ§åˆ¶å°æ‰“å°å‡ºè“è‰²çš„ log æ—¥å¿—ã€‚</p> <p>åˆ°è¿™é‡Œæ•´ä½“çš„æ„å»ºæ‰§è¡Œè¿‡ç¨‹å°±åˆ†æå¥½äº†ï¼Œåœ¨æ§åˆ¶å°å°±å¯çœ‹åˆ°è¾“å‡ºäº†è“è‰²æ‰“åŒ…æ–‡ä»¶çš„æ—¥å¿—ğŸ‘Œã€‚</p> <p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b6eb5a710ce94fb49847e2ee412043ed~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <p>é‚£ä¹ˆæ‰“åŒ…æ—¶å…·ä½“çš„å…¥å£æ–‡ä»¶å’Œæ‰“åŒ…åç”Ÿæˆçš„æ–‡ä»¶æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œå°±è¦æ¥çœ‹ <code>config.js</code> çš„å†…å®¹ã€‚</p> <h2 id="config-js"><a href="#config-js" class="header-anchor">#</a> config.js</h2> <p>å¯ä»¥å…ˆç‚¹è¿™é‡Œæ‰“å¼€ <a href="https://github.com/vuejs/vue/blob/dev/scripts/config.js" target="_blank" rel="noopener noreferrer">config.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æºç ã€‚ <code>builds</code> æ•°ç»„å®šä¹‰äº†å¤šä¸ªé”®å€¼å¯¹åŒ…å«å…¥å£æ–‡ä»¶ <code>entry</code>ã€è¾“å‡ºæ–‡ä»¶ <code>dest</code>ã€è¾“å‡ºæ ¼å¼ <code>format</code>ã€è¾“å‡ºæ–‡ä»¶å¤´éƒ¨ä¿¡æ¯ <code>banner</code> ç­‰ï¼Œ<strong><code>genConfig</code> æ–¹æ³•è´Ÿè´£å°†è¿™äº›ä¿¡æ¯è½¬åŒ–æˆ <code>rollup</code> éœ€è¦çš„æ ¼å¼</strong>ã€‚è´´ä¸€ä¸ªæ–‡ä»¶æ ¼å¼çš„åŒºåˆ«ï¼š</p> <ul><li><code>amd</code>Â â€“ å¼‚æ­¥æ¨¡å—å®šä¹‰ï¼Œç”¨äºåƒRequireJSè¿™æ ·çš„æ¨¡å—åŠ è½½å™¨</li> <li><code>cjs</code>Â â€“ CommonJSï¼Œé€‚ç”¨äº Node å’Œ Browserify/Webpack</li> <li><code>esm</code>Â â€“ å°†è½¯ä»¶åŒ…ä¿å­˜ä¸º ES æ¨¡å—æ–‡ä»¶ï¼Œåœ¨ç°ä»£æµè§ˆå™¨ä¸­å¯ä»¥é€šè¿‡Â <code>&lt;script type=module&gt;</code>Â æ ‡ç­¾å¼•å…¥</li> <li><code>iife</code>Â â€“ ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œçš„åŠŸèƒ½ï¼Œé€‚åˆä½œä¸º<code>&lt;script&gt;</code>æ ‡ç­¾ã€‚ï¼ˆå¦‚æœè¦ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªæ†ç»‘åŒ…ï¼Œæ‚¨å¯èƒ½æƒ³è¦ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒä¼šä½¿æ–‡ä»¶å¤§å°å˜å°ã€‚ï¼‰</li> <li><code>umd</code>Â â€“ é€šç”¨æ¨¡å—å®šä¹‰ï¼Œä»¥<code>amd</code>ï¼Œ<code>cjs</code>Â å’ŒÂ <code>iife</code>Â ä¸ºä¸€ä½“</li> <li><code>system</code>Â - SystemJS åŠ è½½å™¨æ ¼å¼</li></ul> <p><code>config.js</code> çš„æ–‡ä»¶å¼€å¤´å¼•å…¥äº†ä¸€äº›å…³äº <code>rollup</code> çš„ <code>plugin</code>ï¼Œäº†è§£ä¸€ä¸‹è¿™äº› <code>rollup plugin</code> çš„ä½œç”¨ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buble <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-buble'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> alias <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-alias'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cjs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-commonjs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> replace <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-replace'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-node-resolve'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> flow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-flow-no-whitespace'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><strong>rollup-plugin-buble</strong> æ˜¯ rollup çš„ ES6 ç¼–è¯‘æ’ä»¶ï¼ŒåŠŸèƒ½å¦‚åŒç®€åŒ–ç‰ˆ babelï¼›</li> <li><strong>rollup-plugin-alias</strong> ç”¨äºé…ç½®åˆ«åï¼›</li> <li><strong>rollup-plugin-commonjs</strong> è½¬åŒ– CommonJS åˆ° ES6ï¼›</li> <li><strong>rollup-plugin-replace</strong> æ›¿æ¢æ–‡ä»¶ä¸­çš„ç›®æ ‡å­—ç¬¦ï¼›</li> <li><strong>rollup-plugin-node-resolve</strong> é…åˆ <strong>rollup-plugin-commonjs</strong> è§£æç¬¬ä¸‰æ–¹æ¨¡å—ï¼›</li> <li><strong>rollup-plugin-flow-no-whitespace</strong> æ¸…é™¤ flow è¯­æ³•ï¼Œé˜²æ­¢æ‰“åŒ…æŠ¥é”™ã€‚</li></ul> <p>æˆ‘ä»¬ä» ğŸ‘† build ä¸­ä¸¾ä¸€ä¸ª <code>Runtime only</code> æ‰“åŒ…ä¿¡æ¯çš„ä¾‹å­çœ‹çœ‹ï¼Œå¯¹æ¯”ä¸€ä¸‹ vue.js ä¸­å®šä¹‰çš„æ‰“åŒ…ä¿¡æ¯å’Œ rollup ä¸­éœ€è¦çš„æ‰“åŒ…ä¿¡æ¯ï¼š</p> <p><code>vue.js</code> å®šä¹‰çš„å†…å®¹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> builds <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// Runtime only (CommonJS). Used by bundlers e.g. Webpack &amp; Browserify</span>
  <span class="token string-property property">'web-runtime-cjs-dev'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'web/entry-runtime.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dest</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'dist/vue.runtime.common.dev.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    banner
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>rollup</code> æ¥æ”¶çš„å†…å®¹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">genConfig</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> builds<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">input</span><span class="token operator">:</span> opts<span class="token punctuation">.</span>entry<span class="token punctuation">,</span>
    <span class="token literal-property property">external</span><span class="token operator">:</span> opts<span class="token punctuation">.</span>external<span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">flow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">alias</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> aliases<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>alias<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>plugins <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> opts<span class="token punctuation">.</span>dest<span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> opts<span class="token punctuation">.</span>format<span class="token punctuation">,</span>
      <span class="token literal-property property">banner</span><span class="token operator">:</span> opts<span class="token punctuation">.</span>banner<span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> opts<span class="token punctuation">.</span>moduleName <span class="token operator">||</span> <span class="token string">'Vue'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onwarn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> warn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Circular</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ° <code>genConfig</code> æ–¹æ³•åšäº†ä¸€äº›æ ¼å¼çš„è½¬åŒ–ã€‚è€Œé™¤äº†è½¬åŒ–æ ¼å¼ä¹‹å¤–ï¼Œè¿˜æ·»åŠ äº†ä¸€äº›ç¯å¢ƒå˜é‡ ğŸ‘‡ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// built-in vars</span>
  <span class="token keyword">const</span> vars <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">__WEEX__</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>opts<span class="token punctuation">.</span>weex<span class="token punctuation">,</span>
    <span class="token literal-property property">__WEEX_VERSION__</span><span class="token operator">:</span> weexVersion<span class="token punctuation">,</span>
    <span class="token literal-property property">__VERSION__</span><span class="token operator">:</span> version
  <span class="token punctuation">}</span>
  <span class="token comment">// feature flags</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>featureFlags<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    vars<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">process.env.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> featureFlags<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// build-specific env</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>env<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vars<span class="token punctuation">[</span><span class="token string">'process.env.NODE_ENV'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>env<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span>vars<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>transpile <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">buble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token string">'_name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> name
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> config
<span class="token punctuation">}</span>
</code></pre></div><h2 id="runtime-only-å’Œ-runtime-compiler"><a href="#runtime-only-å’Œ-runtime-compiler" class="header-anchor">#</a> Runtime only å’Œ Runtime + compiler</h2> <p>å›è¿‡å¤´æ¥å†çœ‹ <code>Vue.js</code> ä¸­å®šä¹‰çš„å…·ä½“çš„æ‰“åŒ…ä¿¡æ¯ã€‚åœ¨ <code>config.js</code> çš„ <code>build</code> æ¨¡å¼ä¸­å®šä¹‰äº†å¤šç§æ„å»ºçš„å…¥å£æ–‡ä»¶ã€‚å…¶ä¸­æœ€å¤šçš„å…¥å£æ–‡ä»¶æ˜¯ <strong><code>web/entry-runtime-with-compiler.js</code>ï¼ˆRuntime+compilerï¼‰</strong> å’Œ <strong><code>web/entry-runtime.js</code>ï¼ˆRuntime only ä½¿ç”¨ï¼‰</strong>ã€‚</p> <p>é‚£ä¹ˆ <code>Runtime only</code> å’Œ <code>Runtime + compiler</code> æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p> <p>æ•´ä½“æ¥è¯´ï¼Œ<code>Runtime + compiler</code> æ¨¡å¼çš„æµç¨‹æ˜¯ template -&gt; ast -&gt; render -&gt; vdom -&gt; UIï¼Œè€Œ <code>Runtime only</code> æ¨¡å¼çš„æµç¨‹åªæœ‰ render -&gt; vdom -&gt; UIã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è¿™ç§æƒ…å†µéœ€è¦ compiler</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token string">'&lt;div&gt;{{ h }}&lt;/div&gt;'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// è¿™ç§æƒ…å†µä¸éœ€è¦ compilerï¼Œç”¨ Runtime only</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>h<span class="token punctuation">)</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>å®ƒä»¬åŒºåˆ«åœ¨äº <code>Runtime + compiler</code> æ˜¯åŒ…å«ç¼–è¯‘è¿‡ç¨‹çš„ï¼ŒæŠŠç¼–è¯‘ä»£ç æ”¾åœ¨è¿è¡Œæ—¶åšã€‚<code>Runtime only</code> éœ€è¦ç»“åˆ <code>vue-template-compiler</code> äº‹å…ˆå°†æ¨¡ç‰ˆç¼–è¯‘æˆ <code>render</code> å‡½æ•°å†æ‰§è¡Œï¼ˆğŸ‘‡ ä¸‹é¢çš„æºç å¯ä»¥çœ‹å‡ºï¼‰ã€‚
å› ä¸ºç¼ºå°‘ä¸€äº›ç¼–è¯‘è¿‡ç¨‹ï¼Œ<code>Runtime only</code> è¿è¡Œèµ·æ¥ä¼šæ›´å¿«ä¸€äº›ã€‚</p> <p><code>vue-cli</code> é»˜è®¤ä¹Ÿé‡‡ç”¨äº† <code>only</code> çš„æ–¹å¼ï¼Œåœ¨ <code>main.js</code> ä¸­ç”Ÿæˆçš„ä»£ç å°±å¯ä»¥ä½“ç°ï¼Œå¦å¤– <code>package.json</code> ä¸­ä¹Ÿå¸®æˆ‘ä»¬å®‰è£…äº† <code>vue-template-complier</code>ã€‚</p> <p>æˆ‘ä»¬æ¥æ¯”è¾ƒ <code>entry-runtime-with-compiler.js</code> å’Œ <code>entry-runtime.js</code> è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œä»–ä»¬éƒ½ä» <code>/runtime/index</code> import äº†ç›¸åŒçš„ Vueï¼Œè€Œ complier å¤šåšäº†ä¸€äº›å¤„ç†ã€‚</p> <p><code>entry-runtime-with-compiler.js</code>çš„å†…å®¹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* @flow */</span>

<span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'core/config'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> warn<span class="token punctuation">,</span> cached <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'core/util/index'</span> <span class="token comment">// warnå¯ä»¥å‘å‡º[Vue warn]: è­¦å‘Šä¿¡æ¯ã€‚cachedæ˜¯åˆ›å»ºä¸€ä¸ªçº¯å‡½æ•°æ–¹æ³•çš„ç¼“å­˜ã€‚</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mark<span class="token punctuation">,</span> measure <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'core/util/perf'</span> <span class="token comment">// æµè§ˆå™¨æ€§èƒ½ç›¸å…³ï¼šåˆ›å»ºæ—¶é—´æˆ³å’Œæµ‹é‡(measure)ã€‚</span>

<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'./runtime/index'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> query <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./util/index'</span> <span class="token comment">// æŸ¥è¯¢å…ƒç´ ï¼Œå¦‚æœæ˜¯domå…ƒç´ ç›´æ¥è¿”å›ã€‚</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> compileToFunctions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./compiler/index'</span> <span class="token comment">// ç¼–è¯‘æ¨¡ç‰ˆ parse template -&gt; ast -&gt; optimize -&gt; generate -&gt; render</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shouldDecodeNewlines<span class="token punctuation">,</span> shouldDecodeNewlinesForHref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./util/compat'</span> <span class="token comment">// æ£€æŸ¥å½“å‰ç¯å¢ƒæ˜¯å¦éœ€è¦å¯¹å­—ç¬¦è¿›è¡Œç¼–ç </span>

<span class="token keyword">const</span> idToTemplate <span class="token operator">=</span> <span class="token function">cached</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token comment">// æ ¹æ®é€‰æ‹©å™¨æŸ¥è¯¢å…ƒç´ </span>
  <span class="token keyword">return</span> el <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span>innerHTML
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> mount <span class="token operator">=</span> <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$mount
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$mount</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token comment">// Vue.prototype.$mount è¿”å›ä¸€ä¸ª Componentã€‚</span>
  el<span class="token operator">?</span><span class="token operator">:</span> string <span class="token operator">|</span> Element<span class="token punctuation">,</span>
  hydrating<span class="token operator">?</span><span class="token operator">:</span> boolean
<span class="token punctuation">)</span><span class="token operator">:</span> Component <span class="token punctuation">{</span>
  el <span class="token operator">=</span> el <span class="token operator">&amp;&amp;</span> <span class="token function">query</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>

  <span class="token comment">/* istanbul ignore if */</span>
  <span class="token comment">// åˆ¤æ–­æŒ‚åœ¨çš„å…ƒç´ æ˜¯å¦ä¸º html æˆ– bodyï¼Œå‘å‡ºè­¦å‘Šã€‚</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>el <span class="token operator">===</span> document<span class="token punctuation">.</span>body <span class="token operator">||</span> el <span class="token operator">===</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Do not mount Vue to &lt;html&gt; or &lt;body&gt; - mount to normal elements instead.</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options
  <span class="token comment">// resolve template/el and convert to render function</span>
  <span class="token comment">// å°† template/el è½¬åŒ–æˆ render å‡½æ•°</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> template <span class="token operator">=</span> options<span class="token punctuation">.</span>template
    <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> template <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'#'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          template <span class="token operator">=</span> <span class="token function">idToTemplate</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>
          <span class="token comment">/* istanbul ignore if */</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">warn</span><span class="token punctuation">(</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Template element not found or is empty: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>template<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
              <span class="token keyword">this</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        template <span class="token operator">=</span> template<span class="token punctuation">.</span>innerHTML
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'invalid template option:'</span> <span class="token operator">+</span> template<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      template <span class="token operator">=</span> <span class="token function">getOuterHTML</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è·å–å®Œæˆ template åºåˆ—åŒ–åçš„ HTML ç‰‡æ®µã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/* istanbul ignore if */</span>
      <span class="token comment">// æ‰“ä¸€ä¸ªåä¸º compile çš„æ—¶é—´æˆ³ã€‚</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> mark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">mark</span><span class="token punctuation">(</span><span class="token string">'compile'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// è§£æ template è·å¾— render</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> staticRenderFns <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">outputSourceRange</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
        shouldDecodeNewlines<span class="token punctuation">,</span>
        shouldDecodeNewlinesForHref<span class="token punctuation">,</span>
        <span class="token literal-property property">delimiters</span><span class="token operator">:</span> options<span class="token punctuation">.</span>delimiters<span class="token punctuation">,</span>
        <span class="token literal-property property">comments</span><span class="token operator">:</span> options<span class="token punctuation">.</span>comments
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
      options<span class="token punctuation">.</span>render <span class="token operator">=</span> render
      options<span class="token punctuation">.</span>staticRenderFns <span class="token operator">=</span> staticRenderFns

      <span class="token comment">/* istanbul ignore if */</span>
      <span class="token comment">// è·å–æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹çš„æ€§èƒ½</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> mark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">mark</span><span class="token punctuation">(</span><span class="token string">'compile end'</span><span class="token punctuation">)</span>
        <span class="token function">measure</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> compile</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'compile'</span><span class="token punctuation">,</span> <span class="token string">'compile end'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">mount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> el<span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Get outerHTML of elements, taking care
 * of SVG elements in IE as well.
 * è·å–æè¿°å…ƒç´ ï¼ˆåŒ…æ‹¬å…¶åä»£ï¼‰çš„åºåˆ—åŒ–HTMLç‰‡æ®µï¼Œä¾‹å¦‚'&lt;div id=&quot;d&quot;&gt;&lt;p&gt;Content&lt;/p&gt;&lt;p&gt;Further Elaborated&lt;/p&gt;&lt;/div&gt;'ã€‚
 */</span>
<span class="token keyword">function</span> <span class="token function">getOuterHTML</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> Element</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>outerHTML<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> el<span class="token punctuation">.</span>outerHTML
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> container<span class="token punctuation">.</span>innerHTML
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Vue<span class="token punctuation">.</span>compile <span class="token operator">=</span> compileToFunctions <span class="token comment">// è·å¾— {ast, render, staticRenderFns}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Vue
</code></pre></div><p><code>entry-runtime.js</code> åªæœ‰è¿™äº›å†…å®¹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* @flow */</span>

<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'./runtime/index'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Vue
</code></pre></div><p>è¯¦ç»†çš„ç¼–è¯‘è¿‡ç¨‹å¯ä»¥å» <code>/src/util/compat</code> æ–‡ä»¶ä¸‹çœ‹ <code>compileToFunctions</code> æ–¹æ³•çš„å®ç°ã€‚å¤§è‡´çš„è¿‡ç¨‹æ˜¯ä» <code>parse template</code> -&gt; <code>ast</code> -&gt; <code>optimize</code> -&gt; <code>generate</code> -&gt; <code>render</code>ã€‚</p> <h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p><code>Vue.js + Rollup</code> çš„æ„å»ºæµç¨‹å°±æ˜¯è¿™æ ·å•¦ï¼Œä¸»è¦å®šä¹‰äº†ä¸€äº›å…¥å£æ–‡ä»¶å’Œå‡ºå£æ–‡ä»¶ä¿¡æ¯ï¼Œä»¥åŠåˆ¤æ–­äº†åœ¨ä¸åŒç¯å¢ƒä¸‹æ¨¡å—çš„æ‰“åŒ…æ–¹å¼ã€‚éœ€è¦å¼„æ¸…æ¥šçš„æ˜¯ <code>Runtime only</code> å’Œ <code>Runtime + compiler</code> æ–¹å¼çš„ä¸åŒã€‚</p> <p>å› ä¸ºæœ€è¿‘åœ¨çœ‹ <code>Vue.js</code> çš„æºç ï¼Œæ‰€æœ‰å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°å’Œæ€»ç»“éƒ½ä¼šè®°å½•åœ¨æˆ‘çš„ <a href="https://github.com/Gesj-yean/vue-demo-collection" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¸­ï¼Œæ„Ÿè°¢å…³æ³¨ã€‚</p> <h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="header-anchor">#</a> å‚è€ƒæ–‡æ¡£</h2> <ul><li><a href="http://nodejs.cn/api/process.html" target="_blank" rel="noopener noreferrer"><strong>Node.js ä¸­æ–‡ç½‘</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.rollupjs.com/" target="_blank" rel="noopener noreferrer"><strong>rollup.js ä¸­æ–‡æ–‡æ¡£</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">10/6/2021, 2:36:20 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/vue-demo-collection/note/vue2/part1-start.html" class="prev">
        part1 - åŸºæœ¬çŸ¥è¯†ï¼šFlow
      </a></span> <span class="next"><a href="/vue-demo-collection/note/vue2/part3-entry.html">
        part3 - Vue.js å…¥å£æ–‡ä»¶åˆ†æ
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vue-demo-collection/assets/js/app.f5b96e8e.js" defer></script><script src="/vue-demo-collection/assets/js/7.ac4e68a0.js" defer></script><script src="/vue-demo-collection/assets/js/78.ffce0429.js" defer></script>
  </body>
</html>
